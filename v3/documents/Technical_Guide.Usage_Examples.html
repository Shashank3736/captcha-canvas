<!DOCTYPE html><html class="default" lang="en" data-base="../"><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>Usage Examples | captcha-canvas API Documentation - v3.3.4</title><meta name="description" content="Documentation for captcha-canvas API Documentation"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="../assets/style.css"/><link rel="stylesheet" href="../assets/highlight.css"/><script defer src="../assets/main.js"></script><script async src="../assets/icons.js" id="tsd-icons-script"></script><script async src="../assets/search.js" id="tsd-search-script"></script><script async src="../assets/navigation.js" id="tsd-nav-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => window.app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><a href="https://captcha-canvas.js.org/v3/" class="title">captcha-canvas API Documentation - v3.3.4</a><div id="tsd-toolbar-links"><a href="https://github.com/Shashank3736/captcha-canvas">GitHub</a><a href="https://www.npmjs.com/package/captcha-canvas">NPM</a></div><button id="tsd-search-trigger" class="tsd-widget" aria-label="Search"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-search"></use></svg></button><dialog id="tsd-search" aria-label="Search"><input role="combobox" id="tsd-search-input" aria-controls="tsd-search-results" aria-autocomplete="list" aria-expanded="true" autocapitalize="off" autocomplete="off" placeholder="Search the docs" maxLength="100"/><ul role="listbox" id="tsd-search-results"></ul><div id="tsd-search-status" aria-live="polite" aria-atomic="true"><div>Preparing search index...</div></div></dialog><a href="#" class="tsd-widget menu" id="tsd-toolbar-menu-trigger" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-menu"></use></svg></a></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><ul class="tsd-breadcrumb" aria-label="Breadcrumb"><li><a href="Technical_Guide.html">Technical Guide</a></li><li><a href="" aria-current="page">Usage Examples</a></li></ul></div><div class="tsd-panel tsd-typography"><h1 id="usage-examples" class="tsd-anchor-link">Usage Examples<a href="#usage-examples" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h1><p>This document provides practical examples of using captcha-canvas in various real-world scenarios.</p>
<h2 id="table-of-contents" class="tsd-anchor-link">Table of Contents<a href="#table-of-contents" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><ul>
<li><a href="#basic-usage">Basic Usage</a></li>
<li><a href="#web-integration">Web Integration</a></li>
<li><a href="#advanced-customization">Advanced Customization</a></li>
<li><a href="#synchronous-generation">Synchronous Generation</a></li>
<li><a href="#error-handling">Error Handling</a></li>
<li><a href="#testing">Testing</a></li>
<li><a href="#performance-optimization">Performance Optimization</a></li>
<li><a href="#mobile-friendly-captchas">Mobile-Friendly CAPTCHAs</a></li>
</ul>
<h2 id="basic-usage" class="tsd-anchor-link">Basic Usage<a href="#basic-usage" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><h3 id="simple-captcha-generation" class="tsd-anchor-link">Simple CAPTCHA Generation<a href="#simple-captcha-generation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="javascript"><span class="hl-0">const</span><span class="hl-1"> { </span><span class="hl-2">createCaptcha</span><span class="hl-1"> } = </span><span class="hl-3">require</span><span class="hl-1">(</span><span class="hl-4">&quot;captcha-canvas&quot;</span><span class="hl-1">);</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">fs</span><span class="hl-1"> = </span><span class="hl-3">require</span><span class="hl-1">(</span><span class="hl-4">&quot;fs&quot;</span><span class="hl-1">);</span><br/><br/><span class="hl-0">async</span><span class="hl-1"> </span><span class="hl-0">function</span><span class="hl-1"> </span><span class="hl-3">generateSimpleCaptcha</span><span class="hl-1">() {</span><br/><span class="hl-1">    </span><span class="hl-0">const</span><span class="hl-1"> { </span><span class="hl-2">image</span><span class="hl-1">, </span><span class="hl-2">text</span><span class="hl-1"> } = </span><span class="hl-3">createCaptcha</span><span class="hl-1">(</span><span class="hl-6">300</span><span class="hl-1">, </span><span class="hl-6">100</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">buffer</span><span class="hl-1"> = </span><span class="hl-8">await</span><span class="hl-1"> </span><span class="hl-7">image</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-7">fs</span><span class="hl-1">.</span><span class="hl-3">writeFileSync</span><span class="hl-1">(</span><span class="hl-4">&quot;captcha.png&quot;</span><span class="hl-1">, </span><span class="hl-7">buffer</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-7">console</span><span class="hl-1">.</span><span class="hl-3">log</span><span class="hl-1">(</span><span class="hl-4">&quot;CAPTCHA text:&quot;</span><span class="hl-1">, </span><span class="hl-7">text</span><span class="hl-1">);</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-3">generateSimpleCaptcha</span><span class="hl-1">();</span>
</code><button type="button">Copy</button></pre>

<h3 id="using-captchagenerator-class" class="tsd-anchor-link">Using CaptchaGenerator Class<a href="#using-captchagenerator-class" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="javascript"><span class="hl-0">const</span><span class="hl-1"> { </span><span class="hl-2">CaptchaGenerator</span><span class="hl-1"> } = </span><span class="hl-3">require</span><span class="hl-1">(</span><span class="hl-4">&quot;captcha-canvas&quot;</span><span class="hl-1">);</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">fs</span><span class="hl-1"> = </span><span class="hl-3">require</span><span class="hl-1">(</span><span class="hl-4">&quot;fs&quot;</span><span class="hl-1">);</span><br/><br/><span class="hl-0">async</span><span class="hl-1"> </span><span class="hl-0">function</span><span class="hl-1"> </span><span class="hl-3">generateAdvancedCaptcha</span><span class="hl-1">() {</span><br/><span class="hl-1">    </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">captcha</span><span class="hl-1"> = </span><span class="hl-0">new</span><span class="hl-1"> </span><span class="hl-3">CaptchaGenerator</span><span class="hl-1">()</span><br/><span class="hl-1">        .</span><span class="hl-3">setDimension</span><span class="hl-1">(</span><span class="hl-6">400</span><span class="hl-1">, </span><span class="hl-6">150</span><span class="hl-1">)</span><br/><span class="hl-1">        .</span><span class="hl-3">setCaptcha</span><span class="hl-1">({</span><br/><span class="hl-1">            </span><span class="hl-7">text:</span><span class="hl-1"> </span><span class="hl-4">&quot;SECURE&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-7">size:</span><span class="hl-1"> </span><span class="hl-6">60</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-7">color:</span><span class="hl-1"> </span><span class="hl-4">&quot;#2c3e50&quot;</span><br/><span class="hl-1">        })</span><br/><span class="hl-1">        .</span><span class="hl-3">setTrace</span><span class="hl-1">({</span><br/><span class="hl-1">            </span><span class="hl-7">color:</span><span class="hl-1"> </span><span class="hl-4">&quot;#95a5a6&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-7">size:</span><span class="hl-1"> </span><span class="hl-6">4</span><br/><span class="hl-1">        });</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">buffer</span><span class="hl-1"> = </span><span class="hl-8">await</span><span class="hl-1"> </span><span class="hl-7">captcha</span><span class="hl-1">.</span><span class="hl-3">generate</span><span class="hl-1">();</span><br/><span class="hl-1">    </span><span class="hl-7">fs</span><span class="hl-1">.</span><span class="hl-3">writeFileSync</span><span class="hl-1">(</span><span class="hl-4">&quot;advanced-captcha.png&quot;</span><span class="hl-1">, </span><span class="hl-7">buffer</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-7">console</span><span class="hl-1">.</span><span class="hl-3">log</span><span class="hl-1">(</span><span class="hl-4">&quot;CAPTCHA text:&quot;</span><span class="hl-1">, </span><span class="hl-7">captcha</span><span class="hl-1">.</span><span class="hl-7">text</span><span class="hl-1">);</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-3">generateAdvancedCaptcha</span><span class="hl-1">();</span>
</code><button type="button">Copy</button></pre>

<h3 id="typescript-usage" class="tsd-anchor-link">TypeScript Usage<a href="#typescript-usage" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-8">import</span><span class="hl-1"> { </span><span class="hl-7">CaptchaGenerator</span><span class="hl-1">, </span><span class="hl-7">createCaptcha</span><span class="hl-1">, </span><span class="hl-7">SetCaptchaOption</span><span class="hl-1"> } </span><span class="hl-8">from</span><span class="hl-1"> </span><span class="hl-4">&#39;captcha-canvas&#39;</span><span class="hl-1">;</span><br/><span class="hl-8">import</span><span class="hl-1"> </span><span class="hl-7">fs</span><span class="hl-1"> </span><span class="hl-8">from</span><span class="hl-1"> </span><span class="hl-4">&#39;fs&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-0">async</span><span class="hl-1"> </span><span class="hl-0">function</span><span class="hl-1"> </span><span class="hl-3">typescriptExample</span><span class="hl-1">(): </span><span class="hl-9">Promise</span><span class="hl-1">&lt;</span><span class="hl-9">void</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">    </span><span class="hl-5">// Using the simple function API</span><br/><span class="hl-1">    </span><span class="hl-0">const</span><span class="hl-1"> { </span><span class="hl-2">image</span><span class="hl-1">, </span><span class="hl-2">text</span><span class="hl-1"> } = </span><span class="hl-3">createCaptcha</span><span class="hl-1">(</span><span class="hl-6">300</span><span class="hl-1">, </span><span class="hl-6">100</span><span class="hl-1">, {</span><br/><span class="hl-1">        </span><span class="hl-7">captcha:</span><span class="hl-1"> { </span><span class="hl-7">characters:</span><span class="hl-1"> </span><span class="hl-6">6</span><span class="hl-1">, </span><span class="hl-7">size:</span><span class="hl-1"> </span><span class="hl-6">40</span><span class="hl-1"> },</span><br/><span class="hl-1">        </span><span class="hl-7">trace:</span><span class="hl-1"> { </span><span class="hl-7">color:</span><span class="hl-1"> </span><span class="hl-4">&#39;#95a5a6&#39;</span><span class="hl-1"> }</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">buffer</span><span class="hl-1"> = </span><span class="hl-8">await</span><span class="hl-1"> </span><span class="hl-7">image</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-7">fs</span><span class="hl-1">.</span><span class="hl-3">writeFileSync</span><span class="hl-1">(</span><span class="hl-4">&#39;simple-captcha.png&#39;</span><span class="hl-1">, </span><span class="hl-7">buffer</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-5">// Using the class API with type safety</span><br/><span class="hl-1">    </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">config</span><span class="hl-1">: </span><span class="hl-9">SetCaptchaOption</span><span class="hl-1"> = {</span><br/><span class="hl-1">        </span><span class="hl-7">text:</span><span class="hl-1"> </span><span class="hl-4">&#39;HELLO&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-7">size:</span><span class="hl-1"> </span><span class="hl-6">50</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-7">colors:</span><span class="hl-1"> [</span><span class="hl-4">&#39;#e74c3c&#39;</span><span class="hl-1">, </span><span class="hl-4">&#39;#3498db&#39;</span><span class="hl-1">]</span><br/><span class="hl-1">    };</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">captcha</span><span class="hl-1"> = </span><span class="hl-0">new</span><span class="hl-1"> </span><span class="hl-3">CaptchaGenerator</span><span class="hl-1">({ </span><span class="hl-7">width:</span><span class="hl-1"> </span><span class="hl-6">350</span><span class="hl-1">, </span><span class="hl-7">height:</span><span class="hl-1"> </span><span class="hl-6">120</span><span class="hl-1"> })</span><br/><span class="hl-1">        .</span><span class="hl-3">setCaptcha</span><span class="hl-1">(</span><span class="hl-7">config</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">classBuffer</span><span class="hl-1"> = </span><span class="hl-8">await</span><span class="hl-1"> </span><span class="hl-7">captcha</span><span class="hl-1">.</span><span class="hl-3">generate</span><span class="hl-1">();</span><br/><span class="hl-1">    </span><span class="hl-7">fs</span><span class="hl-1">.</span><span class="hl-3">writeFileSync</span><span class="hl-1">(</span><span class="hl-4">&#39;class-captcha.png&#39;</span><span class="hl-1">, </span><span class="hl-7">classBuffer</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-7">console</span><span class="hl-1">.</span><span class="hl-3">log</span><span class="hl-1">(</span><span class="hl-4">&#39;Generated text:&#39;</span><span class="hl-1">, </span><span class="hl-7">captcha</span><span class="hl-1">.</span><span class="hl-7">text</span><span class="hl-1">);</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<h2 id="web-integration" class="tsd-anchor-link">Web Integration<a href="#web-integration" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><h3 id="expressjs-server-with-session-management" class="tsd-anchor-link">Express.js Server with Session Management<a href="#expressjs-server-with-session-management" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="javascript"><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">express</span><span class="hl-1"> = </span><span class="hl-3">require</span><span class="hl-1">(</span><span class="hl-4">&quot;express&quot;</span><span class="hl-1">);</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">session</span><span class="hl-1"> = </span><span class="hl-3">require</span><span class="hl-1">(</span><span class="hl-4">&quot;express-session&quot;</span><span class="hl-1">);</span><br/><span class="hl-0">const</span><span class="hl-1"> { </span><span class="hl-2">createCaptcha</span><span class="hl-1"> } = </span><span class="hl-3">require</span><span class="hl-1">(</span><span class="hl-4">&quot;captcha-canvas&quot;</span><span class="hl-1">);</span><br/><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">app</span><span class="hl-1"> = </span><span class="hl-3">express</span><span class="hl-1">();</span><br/><br/><span class="hl-7">app</span><span class="hl-1">.</span><span class="hl-3">use</span><span class="hl-1">(</span><span class="hl-3">session</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-7">secret:</span><span class="hl-1"> </span><span class="hl-4">&quot;your-secret-key&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-7">resave:</span><span class="hl-1"> </span><span class="hl-0">false</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-7">saveUninitialized:</span><span class="hl-1"> </span><span class="hl-0">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-7">cookie:</span><span class="hl-1"> { </span><span class="hl-7">maxAge:</span><span class="hl-1"> </span><span class="hl-6">300000</span><span class="hl-1"> } </span><span class="hl-5">// 5 minutes</span><br/><span class="hl-1">}));</span><br/><br/><span class="hl-7">app</span><span class="hl-1">.</span><span class="hl-3">use</span><span class="hl-1">(</span><span class="hl-7">express</span><span class="hl-1">.</span><span class="hl-3">json</span><span class="hl-1">());</span><br/><span class="hl-7">app</span><span class="hl-1">.</span><span class="hl-3">use</span><span class="hl-1">(</span><span class="hl-7">express</span><span class="hl-1">.</span><span class="hl-3">static</span><span class="hl-1">(</span><span class="hl-4">&#39;public&#39;</span><span class="hl-1">));</span><br/><br/><span class="hl-5">// Generate CAPTCHA endpoint</span><br/><span class="hl-7">app</span><span class="hl-1">.</span><span class="hl-3">get</span><span class="hl-1">(</span><span class="hl-4">&quot;/captcha&quot;</span><span class="hl-1">, </span><span class="hl-0">async</span><span class="hl-1"> (</span><span class="hl-7">req</span><span class="hl-1">, </span><span class="hl-7">res</span><span class="hl-1">) </span><span class="hl-0">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-8">try</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-0">const</span><span class="hl-1"> { </span><span class="hl-2">image</span><span class="hl-1">, </span><span class="hl-2">text</span><span class="hl-1"> } = </span><span class="hl-3">createCaptcha</span><span class="hl-1">(</span><span class="hl-6">300</span><span class="hl-1">, </span><span class="hl-6">100</span><span class="hl-1">, {</span><br/><span class="hl-1">            </span><span class="hl-7">captcha:</span><span class="hl-1"> { </span><br/><span class="hl-1">                </span><span class="hl-7">characters:</span><span class="hl-1"> </span><span class="hl-6">6</span><span class="hl-1">,</span><br/><span class="hl-1">                </span><span class="hl-7">size:</span><span class="hl-1"> </span><span class="hl-6">40</span><span class="hl-1">,</span><br/><span class="hl-1">                </span><span class="hl-7">rotate:</span><span class="hl-1"> </span><span class="hl-6">15</span><br/><span class="hl-1">            },</span><br/><span class="hl-1">            </span><span class="hl-7">trace:</span><span class="hl-1"> { </span><span class="hl-7">opacity:</span><span class="hl-1"> </span><span class="hl-6">0.8</span><span class="hl-1">, </span><span class="hl-7">size:</span><span class="hl-1"> </span><span class="hl-6">3</span><span class="hl-1"> },</span><br/><span class="hl-1">            </span><span class="hl-7">decoy:</span><span class="hl-1"> { </span><span class="hl-7">total:</span><span class="hl-1"> </span><span class="hl-6">25</span><span class="hl-1">, </span><span class="hl-7">opacity:</span><span class="hl-1"> </span><span class="hl-6">0.3</span><span class="hl-1"> }</span><br/><span class="hl-1">        });</span><br/><span class="hl-1">        </span><br/><span class="hl-1">        </span><span class="hl-5">// Store solution in session with timestamp</span><br/><span class="hl-1">        </span><span class="hl-7">req</span><span class="hl-1">.</span><span class="hl-7">session</span><span class="hl-1">.</span><span class="hl-7">captcha</span><span class="hl-1"> = {</span><br/><span class="hl-1">            </span><span class="hl-7">solution:</span><span class="hl-1"> </span><span class="hl-7">text</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-7">timestamp:</span><span class="hl-1"> </span><span class="hl-7">Date</span><span class="hl-1">.</span><span class="hl-3">now</span><span class="hl-1">()</span><br/><span class="hl-1">        };</span><br/><span class="hl-1">        </span><br/><span class="hl-1">        </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">buffer</span><span class="hl-1"> = </span><span class="hl-8">await</span><span class="hl-1"> </span><span class="hl-7">image</span><span class="hl-1">;</span><br/><span class="hl-1">        </span><span class="hl-7">res</span><span class="hl-1">.</span><span class="hl-3">type</span><span class="hl-1">(</span><span class="hl-4">&quot;png&quot;</span><span class="hl-1">).</span><span class="hl-3">send</span><span class="hl-1">(</span><span class="hl-7">buffer</span><span class="hl-1">);</span><br/><span class="hl-1">    } </span><span class="hl-8">catch</span><span class="hl-1"> (</span><span class="hl-7">error</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-7">console</span><span class="hl-1">.</span><span class="hl-3">error</span><span class="hl-1">(</span><span class="hl-4">&#39;CAPTCHA generation error:&#39;</span><span class="hl-1">, </span><span class="hl-7">error</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-7">res</span><span class="hl-1">.</span><span class="hl-3">status</span><span class="hl-1">(</span><span class="hl-6">500</span><span class="hl-1">).</span><span class="hl-3">json</span><span class="hl-1">({ </span><span class="hl-7">error:</span><span class="hl-1"> </span><span class="hl-4">&#39;Failed to generate CAPTCHA&#39;</span><span class="hl-1"> });</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">// Verify CAPTCHA endpoint</span><br/><span class="hl-7">app</span><span class="hl-1">.</span><span class="hl-3">post</span><span class="hl-1">(</span><span class="hl-4">&quot;/verify&quot;</span><span class="hl-1">, (</span><span class="hl-7">req</span><span class="hl-1">, </span><span class="hl-7">res</span><span class="hl-1">) </span><span class="hl-0">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">const</span><span class="hl-1"> { </span><span class="hl-2">captcha</span><span class="hl-1"> } = </span><span class="hl-7">req</span><span class="hl-1">.</span><span class="hl-7">body</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">sessionData</span><span class="hl-1"> = </span><span class="hl-7">req</span><span class="hl-1">.</span><span class="hl-7">session</span><span class="hl-1">.</span><span class="hl-7">captcha</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-5">// Check if CAPTCHA exists and hasn&#39;t expired (5 minutes)</span><br/><span class="hl-1">    </span><span class="hl-8">if</span><span class="hl-1"> (!</span><span class="hl-7">sessionData</span><span class="hl-1"> || </span><span class="hl-7">Date</span><span class="hl-1">.</span><span class="hl-3">now</span><span class="hl-1">() - </span><span class="hl-7">sessionData</span><span class="hl-1">.</span><span class="hl-7">timestamp</span><span class="hl-1"> &gt; </span><span class="hl-6">300000</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-8">return</span><span class="hl-1"> </span><span class="hl-7">res</span><span class="hl-1">.</span><span class="hl-3">json</span><span class="hl-1">({ </span><br/><span class="hl-1">            </span><span class="hl-7">success:</span><span class="hl-1"> </span><span class="hl-0">false</span><span class="hl-1">, </span><br/><span class="hl-1">            </span><span class="hl-7">message:</span><span class="hl-1"> </span><span class="hl-4">&quot;CAPTCHA expired. Please refresh.&quot;</span><span class="hl-1"> </span><br/><span class="hl-1">        });</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-8">if</span><span class="hl-1"> (</span><span class="hl-7">captcha</span><span class="hl-1"> &amp;&amp; </span><span class="hl-7">captcha</span><span class="hl-1">.</span><span class="hl-3">toUpperCase</span><span class="hl-1">() === </span><span class="hl-7">sessionData</span><span class="hl-1">.</span><span class="hl-7">solution</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-7">res</span><span class="hl-1">.</span><span class="hl-3">json</span><span class="hl-1">({ </span><span class="hl-7">success:</span><span class="hl-1"> </span><span class="hl-0">true</span><span class="hl-1">, </span><span class="hl-7">message:</span><span class="hl-1"> </span><span class="hl-4">&quot;CAPTCHA verified!&quot;</span><span class="hl-1"> });</span><br/><span class="hl-1">    } </span><span class="hl-8">else</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-7">res</span><span class="hl-1">.</span><span class="hl-3">json</span><span class="hl-1">({ </span><span class="hl-7">success:</span><span class="hl-1"> </span><span class="hl-0">false</span><span class="hl-1">, </span><span class="hl-7">message:</span><span class="hl-1"> </span><span class="hl-4">&quot;Invalid CAPTCHA&quot;</span><span class="hl-1"> });</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-5">// Clear session data</span><br/><span class="hl-1">    </span><span class="hl-0">delete</span><span class="hl-1"> </span><span class="hl-7">req</span><span class="hl-1">.</span><span class="hl-7">session</span><span class="hl-1">.</span><span class="hl-7">captcha</span><span class="hl-1">;</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">// Refresh CAPTCHA endpoint</span><br/><span class="hl-7">app</span><span class="hl-1">.</span><span class="hl-3">post</span><span class="hl-1">(</span><span class="hl-4">&quot;/captcha/refresh&quot;</span><span class="hl-1">, </span><span class="hl-0">async</span><span class="hl-1"> (</span><span class="hl-7">req</span><span class="hl-1">, </span><span class="hl-7">res</span><span class="hl-1">) </span><span class="hl-0">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-8">try</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-0">const</span><span class="hl-1"> { </span><span class="hl-2">image</span><span class="hl-1">, </span><span class="hl-2">text</span><span class="hl-1"> } = </span><span class="hl-3">createCaptcha</span><span class="hl-1">(</span><span class="hl-6">300</span><span class="hl-1">, </span><span class="hl-6">100</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><br/><span class="hl-1">        </span><span class="hl-7">req</span><span class="hl-1">.</span><span class="hl-7">session</span><span class="hl-1">.</span><span class="hl-7">captcha</span><span class="hl-1"> = {</span><br/><span class="hl-1">            </span><span class="hl-7">solution:</span><span class="hl-1"> </span><span class="hl-7">text</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-7">timestamp:</span><span class="hl-1"> </span><span class="hl-7">Date</span><span class="hl-1">.</span><span class="hl-3">now</span><span class="hl-1">()</span><br/><span class="hl-1">        };</span><br/><span class="hl-1">        </span><br/><span class="hl-1">        </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">buffer</span><span class="hl-1"> = </span><span class="hl-8">await</span><span class="hl-1"> </span><span class="hl-7">image</span><span class="hl-1">;</span><br/><span class="hl-1">        </span><span class="hl-7">res</span><span class="hl-1">.</span><span class="hl-3">type</span><span class="hl-1">(</span><span class="hl-4">&quot;png&quot;</span><span class="hl-1">).</span><span class="hl-3">send</span><span class="hl-1">(</span><span class="hl-7">buffer</span><span class="hl-1">);</span><br/><span class="hl-1">    } </span><span class="hl-8">catch</span><span class="hl-1"> (</span><span class="hl-7">error</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-7">res</span><span class="hl-1">.</span><span class="hl-3">status</span><span class="hl-1">(</span><span class="hl-6">500</span><span class="hl-1">).</span><span class="hl-3">json</span><span class="hl-1">({ </span><span class="hl-7">error:</span><span class="hl-1"> </span><span class="hl-4">&#39;Failed to refresh CAPTCHA&#39;</span><span class="hl-1"> });</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-7">app</span><span class="hl-1">.</span><span class="hl-3">listen</span><span class="hl-1">(</span><span class="hl-6">3000</span><span class="hl-1">, () </span><span class="hl-0">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-7">console</span><span class="hl-1">.</span><span class="hl-3">log</span><span class="hl-1">(</span><span class="hl-4">&quot;Server running on port 3000&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<h3 id="nextjs-api-routes" class="tsd-anchor-link">Next.js API Routes<a href="#nextjs-api-routes" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="javascript"><span class="hl-5">// pages/api/captcha.js</span><br/><span class="hl-8">import</span><span class="hl-1"> { </span><span class="hl-7">createCaptcha</span><span class="hl-1"> } </span><span class="hl-8">from</span><span class="hl-1"> </span><span class="hl-4">&#39;captcha-canvas&#39;</span><span class="hl-1">;</span><br/><span class="hl-8">import</span><span class="hl-1"> { </span><span class="hl-7">withIronSession</span><span class="hl-1"> } </span><span class="hl-8">from</span><span class="hl-1"> </span><span class="hl-4">&#39;next-iron-session&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-0">async</span><span class="hl-1"> </span><span class="hl-0">function</span><span class="hl-1"> </span><span class="hl-3">handler</span><span class="hl-1">(</span><span class="hl-7">req</span><span class="hl-1">, </span><span class="hl-7">res</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-8">if</span><span class="hl-1"> (</span><span class="hl-7">req</span><span class="hl-1">.</span><span class="hl-7">method</span><span class="hl-1"> === </span><span class="hl-4">&#39;GET&#39;</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-8">try</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-0">const</span><span class="hl-1"> { </span><span class="hl-2">image</span><span class="hl-1">, </span><span class="hl-2">text</span><span class="hl-1"> } = </span><span class="hl-3">createCaptcha</span><span class="hl-1">(</span><span class="hl-6">300</span><span class="hl-1">, </span><span class="hl-6">100</span><span class="hl-1">, {</span><br/><span class="hl-1">                </span><span class="hl-7">captcha:</span><span class="hl-1"> { </span><span class="hl-7">characters:</span><span class="hl-1"> </span><span class="hl-6">6</span><span class="hl-1"> },</span><br/><span class="hl-1">                </span><span class="hl-7">decoy:</span><span class="hl-1"> { </span><span class="hl-7">total:</span><span class="hl-1"> </span><span class="hl-6">30</span><span class="hl-1">, </span><span class="hl-7">opacity:</span><span class="hl-1"> </span><span class="hl-6">0.3</span><span class="hl-1"> }</span><br/><span class="hl-1">            });</span><br/><span class="hl-1">            </span><br/><span class="hl-1">            </span><span class="hl-7">req</span><span class="hl-1">.</span><span class="hl-7">session</span><span class="hl-1">.</span><span class="hl-3">set</span><span class="hl-1">(</span><span class="hl-4">&#39;captcha&#39;</span><span class="hl-1">, {</span><br/><span class="hl-1">                </span><span class="hl-7">solution:</span><span class="hl-1"> </span><span class="hl-7">text</span><span class="hl-1">,</span><br/><span class="hl-1">                </span><span class="hl-7">timestamp:</span><span class="hl-1"> </span><span class="hl-7">Date</span><span class="hl-1">.</span><span class="hl-3">now</span><span class="hl-1">()</span><br/><span class="hl-1">            });</span><br/><span class="hl-1">            </span><span class="hl-8">await</span><span class="hl-1"> </span><span class="hl-7">req</span><span class="hl-1">.</span><span class="hl-7">session</span><span class="hl-1">.</span><span class="hl-3">save</span><span class="hl-1">();</span><br/><span class="hl-1">            </span><br/><span class="hl-1">            </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">buffer</span><span class="hl-1"> = </span><span class="hl-8">await</span><span class="hl-1"> </span><span class="hl-7">image</span><span class="hl-1">;</span><br/><span class="hl-1">            </span><span class="hl-7">res</span><span class="hl-1">.</span><span class="hl-3">setHeader</span><span class="hl-1">(</span><span class="hl-4">&#39;Content-Type&#39;</span><span class="hl-1">, </span><span class="hl-4">&#39;image/png&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">            </span><span class="hl-7">res</span><span class="hl-1">.</span><span class="hl-3">send</span><span class="hl-1">(</span><span class="hl-7">buffer</span><span class="hl-1">);</span><br/><span class="hl-1">        } </span><span class="hl-8">catch</span><span class="hl-1"> (</span><span class="hl-7">error</span><span class="hl-1">) {</span><br/><span class="hl-1">            </span><span class="hl-7">res</span><span class="hl-1">.</span><span class="hl-3">status</span><span class="hl-1">(</span><span class="hl-6">500</span><span class="hl-1">).</span><span class="hl-3">json</span><span class="hl-1">({ </span><span class="hl-7">error:</span><span class="hl-1"> </span><span class="hl-4">&#39;CAPTCHA generation failed&#39;</span><span class="hl-1"> });</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">    } </span><span class="hl-8">else</span><span class="hl-1"> </span><span class="hl-8">if</span><span class="hl-1"> (</span><span class="hl-7">req</span><span class="hl-1">.</span><span class="hl-7">method</span><span class="hl-1"> === </span><span class="hl-4">&#39;POST&#39;</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-0">const</span><span class="hl-1"> { </span><span class="hl-2">captcha</span><span class="hl-1"> } = </span><span class="hl-7">req</span><span class="hl-1">.</span><span class="hl-7">body</span><span class="hl-1">;</span><br/><span class="hl-1">        </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">sessionData</span><span class="hl-1"> = </span><span class="hl-7">req</span><span class="hl-1">.</span><span class="hl-7">session</span><span class="hl-1">.</span><span class="hl-3">get</span><span class="hl-1">(</span><span class="hl-4">&#39;captcha&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><br/><span class="hl-1">        </span><span class="hl-8">if</span><span class="hl-1"> (!</span><span class="hl-7">sessionData</span><span class="hl-1"> || </span><span class="hl-7">Date</span><span class="hl-1">.</span><span class="hl-3">now</span><span class="hl-1">() - </span><span class="hl-7">sessionData</span><span class="hl-1">.</span><span class="hl-7">timestamp</span><span class="hl-1"> &gt; </span><span class="hl-6">300000</span><span class="hl-1">) {</span><br/><span class="hl-1">            </span><span class="hl-8">return</span><span class="hl-1"> </span><span class="hl-7">res</span><span class="hl-1">.</span><span class="hl-3">json</span><span class="hl-1">({ </span><span class="hl-7">success:</span><span class="hl-1"> </span><span class="hl-0">false</span><span class="hl-1">, </span><span class="hl-7">message:</span><span class="hl-1"> </span><span class="hl-4">&#39;CAPTCHA expired&#39;</span><span class="hl-1"> });</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">        </span><br/><span class="hl-1">        </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">isValid</span><span class="hl-1"> = </span><span class="hl-7">captcha</span><span class="hl-1">?.</span><span class="hl-3">toUpperCase</span><span class="hl-1">() === </span><span class="hl-7">sessionData</span><span class="hl-1">.</span><span class="hl-7">solution</span><span class="hl-1">;</span><br/><span class="hl-1">        </span><br/><span class="hl-1">        </span><span class="hl-8">if</span><span class="hl-1"> (</span><span class="hl-7">isValid</span><span class="hl-1">) {</span><br/><span class="hl-1">            </span><span class="hl-7">req</span><span class="hl-1">.</span><span class="hl-7">session</span><span class="hl-1">.</span><span class="hl-3">destroy</span><span class="hl-1">();</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">        </span><br/><span class="hl-1">        </span><span class="hl-7">res</span><span class="hl-1">.</span><span class="hl-3">json</span><span class="hl-1">({ </span><br/><span class="hl-1">            </span><span class="hl-7">success:</span><span class="hl-1"> </span><span class="hl-7">isValid</span><span class="hl-1">, </span><br/><span class="hl-1">            </span><span class="hl-7">message:</span><span class="hl-1"> </span><span class="hl-7">isValid</span><span class="hl-1"> ? </span><span class="hl-4">&#39;Verified&#39;</span><span class="hl-1"> : </span><span class="hl-4">&#39;Invalid CAPTCHA&#39;</span><span class="hl-1"> </span><br/><span class="hl-1">        });</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-8">export</span><span class="hl-1"> </span><span class="hl-8">default</span><span class="hl-1"> </span><span class="hl-3">withIronSession</span><span class="hl-1">(</span><span class="hl-7">handler</span><span class="hl-1">, {</span><br/><span class="hl-1">    </span><span class="hl-7">password:</span><span class="hl-1"> </span><span class="hl-7">process</span><span class="hl-1">.</span><span class="hl-7">env</span><span class="hl-1">.</span><span class="hl-2">SECRET_COOKIE_PASSWORD</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-7">cookieName:</span><span class="hl-1"> </span><span class="hl-4">&#39;captcha-session&#39;</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<h2 id="advanced-customization" class="tsd-anchor-link">Advanced Customization<a href="#advanced-customization" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><h3 id="multi-color-rainbow-text" class="tsd-anchor-link">Multi-Color Rainbow Text<a href="#multi-color-rainbow-text" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="javascript"><span class="hl-0">const</span><span class="hl-1"> { </span><span class="hl-2">CaptchaGenerator</span><span class="hl-1"> } = </span><span class="hl-3">require</span><span class="hl-1">(</span><span class="hl-4">&quot;captcha-canvas&quot;</span><span class="hl-1">);</span><br/><br/><span class="hl-0">async</span><span class="hl-1"> </span><span class="hl-0">function</span><span class="hl-1"> </span><span class="hl-3">rainbowCaptcha</span><span class="hl-1">() {</span><br/><span class="hl-1">    </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">captcha</span><span class="hl-1"> = </span><span class="hl-0">new</span><span class="hl-1"> </span><span class="hl-3">CaptchaGenerator</span><span class="hl-1">()</span><br/><span class="hl-1">        .</span><span class="hl-3">setDimension</span><span class="hl-1">(</span><span class="hl-6">450</span><span class="hl-1">, </span><span class="hl-6">150</span><span class="hl-1">)</span><br/><span class="hl-1">        .</span><span class="hl-3">setCaptcha</span><span class="hl-1">({</span><br/><span class="hl-1">            </span><span class="hl-7">text:</span><span class="hl-1"> </span><span class="hl-4">&quot;RAINBOW&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-7">size:</span><span class="hl-1"> </span><span class="hl-6">55</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-7">colors:</span><span class="hl-1"> [</span><br/><span class="hl-1">                </span><span class="hl-4">&quot;#e74c3c&quot;</span><span class="hl-1">, </span><span class="hl-5">// Red</span><br/><span class="hl-1">                </span><span class="hl-4">&quot;#f39c12&quot;</span><span class="hl-1">, </span><span class="hl-5">// Orange  </span><br/><span class="hl-1">                </span><span class="hl-4">&quot;#f1c40f&quot;</span><span class="hl-1">, </span><span class="hl-5">// Yellow</span><br/><span class="hl-1">                </span><span class="hl-4">&quot;#27ae60&quot;</span><span class="hl-1">, </span><span class="hl-5">// Green</span><br/><span class="hl-1">                </span><span class="hl-4">&quot;#3498db&quot;</span><span class="hl-1">, </span><span class="hl-5">// Blue</span><br/><span class="hl-1">                </span><span class="hl-4">&quot;#9b59b6&quot;</span><span class="hl-1">, </span><span class="hl-5">// Purple</span><br/><span class="hl-1">                </span><span class="hl-4">&quot;#e91e63&quot;</span><span class="hl-1">  </span><span class="hl-5">// Pink</span><br/><span class="hl-1">            ],</span><br/><span class="hl-1">            </span><span class="hl-7">rotate:</span><span class="hl-1"> </span><span class="hl-6">10</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-7">skew:</span><span class="hl-1"> </span><span class="hl-0">true</span><br/><span class="hl-1">        })</span><br/><span class="hl-1">        .</span><span class="hl-3">setTrace</span><span class="hl-1">({ </span><br/><span class="hl-1">            </span><span class="hl-7">color:</span><span class="hl-1"> </span><span class="hl-4">&quot;#34495e&quot;</span><span class="hl-1">, </span><br/><span class="hl-1">            </span><span class="hl-7">size:</span><span class="hl-1"> </span><span class="hl-6">3</span><span class="hl-1">, </span><br/><span class="hl-1">            </span><span class="hl-7">opacity:</span><span class="hl-1"> </span><span class="hl-6">0.7</span><span class="hl-1"> </span><br/><span class="hl-1">        });</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-8">return</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-7">buffer:</span><span class="hl-1"> </span><span class="hl-8">await</span><span class="hl-1"> </span><span class="hl-7">captcha</span><span class="hl-1">.</span><span class="hl-3">generate</span><span class="hl-1">(),</span><br/><span class="hl-1">        </span><span class="hl-7">text:</span><span class="hl-1"> </span><span class="hl-7">captcha</span><span class="hl-1">.</span><span class="hl-7">text</span><br/><span class="hl-1">    };</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<h3 id="multi-styled-text-segments" class="tsd-anchor-link">Multi-Styled Text Segments<a href="#multi-styled-text-segments" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="javascript"><span class="hl-0">const</span><span class="hl-1"> { </span><span class="hl-2">CaptchaGenerator</span><span class="hl-1"> } = </span><span class="hl-3">require</span><span class="hl-1">(</span><span class="hl-4">&quot;captcha-canvas&quot;</span><span class="hl-1">);</span><br/><br/><span class="hl-0">async</span><span class="hl-1"> </span><span class="hl-0">function</span><span class="hl-1"> </span><span class="hl-3">multiStyledCaptcha</span><span class="hl-1">() {</span><br/><span class="hl-1">    </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">captcha</span><span class="hl-1"> = </span><span class="hl-0">new</span><span class="hl-1"> </span><span class="hl-3">CaptchaGenerator</span><span class="hl-1">({ </span><span class="hl-7">width:</span><span class="hl-1"> </span><span class="hl-6">500</span><span class="hl-1">, </span><span class="hl-7">height:</span><span class="hl-1"> </span><span class="hl-6">150</span><span class="hl-1"> })</span><br/><span class="hl-1">        .</span><span class="hl-3">setCaptcha</span><span class="hl-1">([</span><br/><span class="hl-1">            { </span><br/><span class="hl-1">                </span><span class="hl-7">text:</span><span class="hl-1"> </span><span class="hl-4">&quot;SEC&quot;</span><span class="hl-1">, </span><br/><span class="hl-1">                </span><span class="hl-7">size:</span><span class="hl-1"> </span><span class="hl-6">60</span><span class="hl-1">, </span><br/><span class="hl-1">                </span><span class="hl-7">color:</span><span class="hl-1"> </span><span class="hl-4">&quot;#e74c3c&quot;</span><span class="hl-1">, </span><br/><span class="hl-1">                </span><span class="hl-7">font:</span><span class="hl-1"> </span><span class="hl-4">&quot;Arial&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">                </span><span class="hl-7">rotate:</span><span class="hl-1"> </span><span class="hl-6">15</span><span class="hl-1"> </span><br/><span class="hl-1">            },</span><br/><span class="hl-1">            { </span><br/><span class="hl-1">                </span><span class="hl-7">text:</span><span class="hl-1"> </span><span class="hl-4">&quot;URE&quot;</span><span class="hl-1">, </span><br/><span class="hl-1">                </span><span class="hl-7">size:</span><span class="hl-1"> </span><span class="hl-6">50</span><span class="hl-1">, </span><br/><span class="hl-1">                </span><span class="hl-7">color:</span><span class="hl-1"> </span><span class="hl-4">&quot;#27ae60&quot;</span><span class="hl-1">, </span><br/><span class="hl-1">                </span><span class="hl-7">font:</span><span class="hl-1"> </span><span class="hl-4">&quot;Times&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">                </span><span class="hl-7">skew:</span><span class="hl-1"> </span><span class="hl-0">true</span><span class="hl-1"> </span><br/><span class="hl-1">            },</span><br/><span class="hl-1">            { </span><br/><span class="hl-1">                </span><span class="hl-7">text:</span><span class="hl-1"> </span><span class="hl-4">&quot;123&quot;</span><span class="hl-1">, </span><br/><span class="hl-1">                </span><span class="hl-7">size:</span><span class="hl-1"> </span><span class="hl-6">45</span><span class="hl-1">, </span><br/><span class="hl-1">                </span><span class="hl-7">color:</span><span class="hl-1"> </span><span class="hl-4">&quot;#3498db&quot;</span><span class="hl-1">, </span><br/><span class="hl-1">                </span><span class="hl-7">font:</span><span class="hl-1"> </span><span class="hl-4">&quot;Courier&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">                </span><span class="hl-7">rotate:</span><span class="hl-1"> -</span><span class="hl-6">10</span><span class="hl-1"> </span><br/><span class="hl-1">            }</span><br/><span class="hl-1">        ])</span><br/><span class="hl-1">        .</span><span class="hl-3">setTrace</span><span class="hl-1">({ </span><span class="hl-7">color:</span><span class="hl-1"> </span><span class="hl-4">&quot;#95a5a6&quot;</span><span class="hl-1">, </span><span class="hl-7">size:</span><span class="hl-1"> </span><span class="hl-6">4</span><span class="hl-1"> });</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-8">return</span><span class="hl-1"> </span><span class="hl-8">await</span><span class="hl-1"> </span><span class="hl-7">captcha</span><span class="hl-1">.</span><span class="hl-3">generate</span><span class="hl-1">();</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<h3 id="background-image-with-noise-pattern" class="tsd-anchor-link">Background Image with Noise Pattern<a href="#background-image-with-noise-pattern" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="javascript"><span class="hl-0">const</span><span class="hl-1"> { </span><span class="hl-2">CaptchaGenerator</span><span class="hl-1">, </span><span class="hl-2">resolveImage</span><span class="hl-1"> } = </span><span class="hl-3">require</span><span class="hl-1">(</span><span class="hl-4">&quot;captcha-canvas&quot;</span><span class="hl-1">);</span><br/><br/><span class="hl-0">async</span><span class="hl-1"> </span><span class="hl-0">function</span><span class="hl-1"> </span><span class="hl-3">noisyBackgroundCaptcha</span><span class="hl-1">() {</span><br/><span class="hl-1">    </span><span class="hl-5">// Create or load a noise pattern background</span><br/><span class="hl-1">    </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">background</span><span class="hl-1"> = </span><span class="hl-8">await</span><span class="hl-1"> </span><span class="hl-3">resolveImage</span><span class="hl-1">(</span><span class="hl-4">&quot;./assets/noise-pattern.jpg&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">captcha</span><span class="hl-1"> = </span><span class="hl-0">new</span><span class="hl-1"> </span><span class="hl-3">CaptchaGenerator</span><span class="hl-1">()</span><br/><span class="hl-1">        .</span><span class="hl-3">setDimension</span><span class="hl-1">(</span><span class="hl-6">400</span><span class="hl-1">, </span><span class="hl-6">150</span><span class="hl-1">)</span><br/><span class="hl-1">        .</span><span class="hl-3">setBackground</span><span class="hl-1">(</span><span class="hl-7">background</span><span class="hl-1">)</span><br/><span class="hl-1">        .</span><span class="hl-3">setCaptcha</span><span class="hl-1">({</span><br/><span class="hl-1">            </span><span class="hl-7">text:</span><span class="hl-1"> </span><span class="hl-4">&quot;SECURE&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-7">size:</span><span class="hl-1"> </span><span class="hl-6">60</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-7">opacity:</span><span class="hl-1"> </span><span class="hl-6">0.95</span><span class="hl-1">,  </span><span class="hl-5">// High opacity to stand out</span><br/><span class="hl-1">            </span><span class="hl-7">colors:</span><span class="hl-1"> [</span><span class="hl-4">&quot;#ffffff&quot;</span><span class="hl-1">, </span><span class="hl-4">&quot;#f8f9fa&quot;</span><span class="hl-1">], </span><span class="hl-5">// Light colors for dark background</span><br/><span class="hl-1">            </span><span class="hl-7">rotate:</span><span class="hl-1"> </span><span class="hl-6">12</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-7">skew:</span><span class="hl-1"> </span><span class="hl-0">true</span><br/><span class="hl-1">        })</span><br/><span class="hl-1">        .</span><span class="hl-3">setTrace</span><span class="hl-1">({ </span><br/><span class="hl-1">            </span><span class="hl-7">color:</span><span class="hl-1"> </span><span class="hl-4">&quot;#ecf0f1&quot;</span><span class="hl-1">, </span><br/><span class="hl-1">            </span><span class="hl-7">size:</span><span class="hl-1"> </span><span class="hl-6">3</span><span class="hl-1">, </span><br/><span class="hl-1">            </span><span class="hl-7">opacity:</span><span class="hl-1"> </span><span class="hl-6">0.8</span><span class="hl-1"> </span><br/><span class="hl-1">        })</span><br/><span class="hl-1">        .</span><span class="hl-3">setDecoy</span><span class="hl-1">({ </span><br/><span class="hl-1">            </span><span class="hl-7">total:</span><span class="hl-1"> </span><span class="hl-6">40</span><span class="hl-1">, </span><br/><span class="hl-1">            </span><span class="hl-7">opacity:</span><span class="hl-1"> </span><span class="hl-6">0.2</span><span class="hl-1">, </span><br/><span class="hl-1">            </span><span class="hl-7">color:</span><span class="hl-1"> </span><span class="hl-4">&quot;#bdc3c7&quot;</span><span class="hl-1"> </span><br/><span class="hl-1">        });</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-8">return</span><span class="hl-1"> </span><span class="hl-8">await</span><span class="hl-1"> </span><span class="hl-7">captcha</span><span class="hl-1">.</span><span class="hl-3">generate</span><span class="hl-1">();</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<h3 id="high-security-configuration" class="tsd-anchor-link">High Security Configuration<a href="#high-security-configuration" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="javascript"><span class="hl-0">const</span><span class="hl-1"> { </span><span class="hl-2">CaptchaGenerator</span><span class="hl-1"> } = </span><span class="hl-3">require</span><span class="hl-1">(</span><span class="hl-4">&quot;captcha-canvas&quot;</span><span class="hl-1">);</span><br/><br/><span class="hl-0">async</span><span class="hl-1"> </span><span class="hl-0">function</span><span class="hl-1"> </span><span class="hl-3">fortKnoxCaptcha</span><span class="hl-1">() {</span><br/><span class="hl-1">    </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">captcha</span><span class="hl-1"> = </span><span class="hl-0">new</span><span class="hl-1"> </span><span class="hl-3">CaptchaGenerator</span><span class="hl-1">({ </span><span class="hl-7">width:</span><span class="hl-1"> </span><span class="hl-6">500</span><span class="hl-1">, </span><span class="hl-7">height:</span><span class="hl-1"> </span><span class="hl-6">200</span><span class="hl-1"> })</span><br/><span class="hl-1">        .</span><span class="hl-3">setCaptcha</span><span class="hl-1">({</span><br/><span class="hl-1">            </span><span class="hl-7">characters:</span><span class="hl-1"> </span><span class="hl-6">8</span><span class="hl-1">,  </span><span class="hl-5">// Longer text</span><br/><span class="hl-1">            </span><span class="hl-7">size:</span><span class="hl-1"> </span><span class="hl-6">55</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-7">rotate:</span><span class="hl-1"> </span><span class="hl-6">25</span><span class="hl-1">,     </span><span class="hl-5">// More rotation</span><br/><span class="hl-1">            </span><span class="hl-7">skew:</span><span class="hl-1"> </span><span class="hl-0">true</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-7">colors:</span><span class="hl-1"> [</span><br/><span class="hl-1">                </span><span class="hl-4">&quot;#2c3e50&quot;</span><span class="hl-1">, </span><span class="hl-4">&quot;#e74c3c&quot;</span><span class="hl-1">, </span><span class="hl-4">&quot;#27ae60&quot;</span><span class="hl-1">, </span><br/><span class="hl-1">                </span><span class="hl-4">&quot;#f39c12&quot;</span><span class="hl-1">, </span><span class="hl-4">&quot;#8e44ad&quot;</span><span class="hl-1">, </span><span class="hl-4">&quot;#16a085&quot;</span><br/><span class="hl-1">            ],</span><br/><span class="hl-1">            </span><span class="hl-7">opacity:</span><span class="hl-1"> </span><span class="hl-6">0.9</span><br/><span class="hl-1">        })</span><br/><span class="hl-1">        .</span><span class="hl-3">setTrace</span><span class="hl-1">({</span><br/><span class="hl-1">            </span><span class="hl-7">size:</span><span class="hl-1"> </span><span class="hl-6">6</span><span class="hl-1">,        </span><span class="hl-5">// Thicker trace lines</span><br/><span class="hl-1">            </span><span class="hl-7">opacity:</span><span class="hl-1"> </span><span class="hl-6">0.9</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-7">color:</span><span class="hl-1"> </span><span class="hl-4">&quot;#34495e&quot;</span><br/><span class="hl-1">        })</span><br/><span class="hl-1">        .</span><span class="hl-3">setDecoy</span><span class="hl-1">({</span><br/><span class="hl-1">            </span><span class="hl-7">total:</span><span class="hl-1"> </span><span class="hl-6">80</span><span class="hl-1">,      </span><span class="hl-5">// Many decoys</span><br/><span class="hl-1">            </span><span class="hl-7">opacity:</span><span class="hl-1"> </span><span class="hl-6">0.4</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-7">size:</span><span class="hl-1"> </span><span class="hl-6">25</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-7">color:</span><span class="hl-1"> </span><span class="hl-4">&quot;#7f8c8d&quot;</span><br/><span class="hl-1">        });</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-8">return</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-7">buffer:</span><span class="hl-1"> </span><span class="hl-8">await</span><span class="hl-1"> </span><span class="hl-7">captcha</span><span class="hl-1">.</span><span class="hl-3">generate</span><span class="hl-1">(),</span><br/><span class="hl-1">        </span><span class="hl-7">solution:</span><span class="hl-1"> </span><span class="hl-7">captcha</span><span class="hl-1">.</span><span class="hl-7">text</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-7">difficulty:</span><span class="hl-1"> </span><span class="hl-4">&quot;maximum&quot;</span><br/><span class="hl-1">    };</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<h2 id="synchronous-generation" class="tsd-anchor-link">Synchronous Generation<a href="#synchronous-generation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><h3 id="batch-processing-for-pre-generation" class="tsd-anchor-link">Batch Processing for Pre-generation<a href="#batch-processing-for-pre-generation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="javascript"><span class="hl-0">const</span><span class="hl-1"> { </span><span class="hl-2">createCaptchaSync</span><span class="hl-1"> } = </span><span class="hl-3">require</span><span class="hl-1">(</span><span class="hl-4">&quot;captcha-canvas&quot;</span><span class="hl-1">);</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">fs</span><span class="hl-1"> = </span><span class="hl-3">require</span><span class="hl-1">(</span><span class="hl-4">&quot;fs&quot;</span><span class="hl-1">);</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">path</span><span class="hl-1"> = </span><span class="hl-3">require</span><span class="hl-1">(</span><span class="hl-4">&quot;path&quot;</span><span class="hl-1">);</span><br/><br/><span class="hl-0">function</span><span class="hl-1"> </span><span class="hl-3">generateCaptchaBatch</span><span class="hl-1">(</span><span class="hl-7">count</span><span class="hl-1">, </span><span class="hl-7">outputDir</span><span class="hl-1"> = </span><span class="hl-4">&quot;./captchas&quot;</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-5">// Ensure output directory exists</span><br/><span class="hl-1">    </span><span class="hl-8">if</span><span class="hl-1"> (!</span><span class="hl-7">fs</span><span class="hl-1">.</span><span class="hl-3">existsSync</span><span class="hl-1">(</span><span class="hl-7">outputDir</span><span class="hl-1">)) {</span><br/><span class="hl-1">        </span><span class="hl-7">fs</span><span class="hl-1">.</span><span class="hl-3">mkdirSync</span><span class="hl-1">(</span><span class="hl-7">outputDir</span><span class="hl-1">, { </span><span class="hl-7">recursive:</span><span class="hl-1"> </span><span class="hl-0">true</span><span class="hl-1"> });</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">captchas</span><span class="hl-1"> = [];</span><br/><span class="hl-1">    </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">startTime</span><span class="hl-1"> = </span><span class="hl-7">Date</span><span class="hl-1">.</span><span class="hl-3">now</span><span class="hl-1">();</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-8">for</span><span class="hl-1"> (</span><span class="hl-0">let</span><span class="hl-1"> </span><span class="hl-7">i</span><span class="hl-1"> = </span><span class="hl-6">0</span><span class="hl-1">; </span><span class="hl-7">i</span><span class="hl-1"> &lt; </span><span class="hl-7">count</span><span class="hl-1">; </span><span class="hl-7">i</span><span class="hl-1">++) {</span><br/><span class="hl-1">        </span><span class="hl-0">const</span><span class="hl-1"> { </span><span class="hl-2">image</span><span class="hl-1">, </span><span class="hl-2">text</span><span class="hl-1"> } = </span><span class="hl-3">createCaptchaSync</span><span class="hl-1">(</span><span class="hl-6">300</span><span class="hl-1">, </span><span class="hl-6">100</span><span class="hl-1">, {</span><br/><span class="hl-1">            </span><span class="hl-7">captcha:</span><span class="hl-1"> { </span><br/><span class="hl-1">                </span><span class="hl-7">characters:</span><span class="hl-1"> </span><span class="hl-6">6</span><span class="hl-1">,</span><br/><span class="hl-1">                </span><span class="hl-7">size:</span><span class="hl-1"> </span><span class="hl-6">40</span><span class="hl-1">,</span><br/><span class="hl-1">                </span><span class="hl-7">rotate:</span><span class="hl-1"> </span><span class="hl-6">15</span><br/><span class="hl-1">            },</span><br/><span class="hl-1">            </span><span class="hl-7">decoy:</span><span class="hl-1"> { </span><span class="hl-7">total:</span><span class="hl-1"> </span><span class="hl-6">25</span><span class="hl-1">, </span><span class="hl-7">opacity:</span><span class="hl-1"> </span><span class="hl-6">0.3</span><span class="hl-1"> },</span><br/><span class="hl-1">            </span><span class="hl-7">trace:</span><span class="hl-1"> { </span><span class="hl-7">size:</span><span class="hl-1"> </span><span class="hl-6">3</span><span class="hl-1">, </span><span class="hl-7">opacity:</span><span class="hl-1"> </span><span class="hl-6">0.8</span><span class="hl-1"> }</span><br/><span class="hl-1">        });</span><br/><span class="hl-1">        </span><br/><span class="hl-1">        </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">filename</span><span class="hl-1"> = </span><span class="hl-4">`captcha-</span><span class="hl-0">${</span><span class="hl-7">Date</span><span class="hl-10">.</span><span class="hl-3">now</span><span class="hl-10">()</span><span class="hl-0">}</span><span class="hl-4">-</span><span class="hl-0">${</span><span class="hl-7">i</span><span class="hl-0">}</span><span class="hl-4">.png`</span><span class="hl-1">;</span><br/><span class="hl-1">        </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">filepath</span><span class="hl-1"> = </span><span class="hl-7">path</span><span class="hl-1">.</span><span class="hl-3">join</span><span class="hl-1">(</span><span class="hl-7">outputDir</span><span class="hl-1">, </span><span class="hl-7">filename</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><br/><span class="hl-1">        </span><span class="hl-7">fs</span><span class="hl-1">.</span><span class="hl-3">writeFileSync</span><span class="hl-1">(</span><span class="hl-7">filepath</span><span class="hl-1">, </span><span class="hl-7">image</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><br/><span class="hl-1">        </span><span class="hl-7">captchas</span><span class="hl-1">.</span><span class="hl-3">push</span><span class="hl-1">({</span><br/><span class="hl-1">            </span><span class="hl-7">id:</span><span class="hl-1"> </span><span class="hl-7">i</span><span class="hl-1"> + </span><span class="hl-6">1</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-7">filename</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-7">filepath</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-7">solution:</span><span class="hl-1"> </span><span class="hl-7">text</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-7">timestamp:</span><span class="hl-1"> </span><span class="hl-7">Date</span><span class="hl-1">.</span><span class="hl-3">now</span><span class="hl-1">()</span><br/><span class="hl-1">        });</span><br/><span class="hl-1">        </span><br/><span class="hl-1">        </span><span class="hl-5">// Progress logging</span><br/><span class="hl-1">        </span><span class="hl-8">if</span><span class="hl-1"> ((</span><span class="hl-7">i</span><span class="hl-1"> + </span><span class="hl-6">1</span><span class="hl-1">) % </span><span class="hl-6">10</span><span class="hl-1"> === </span><span class="hl-6">0</span><span class="hl-1">) {</span><br/><span class="hl-1">            </span><span class="hl-7">console</span><span class="hl-1">.</span><span class="hl-3">log</span><span class="hl-1">(</span><span class="hl-4">`Generated </span><span class="hl-0">${</span><span class="hl-7">i</span><span class="hl-10"> </span><span class="hl-1">+</span><span class="hl-10"> </span><span class="hl-6">1</span><span class="hl-0">}</span><span class="hl-4">/</span><span class="hl-0">${</span><span class="hl-7">count</span><span class="hl-0">}</span><span class="hl-4"> CAPTCHAs`</span><span class="hl-1">);</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">duration</span><span class="hl-1"> = </span><span class="hl-7">Date</span><span class="hl-1">.</span><span class="hl-3">now</span><span class="hl-1">() - </span><span class="hl-7">startTime</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-7">console</span><span class="hl-1">.</span><span class="hl-3">log</span><span class="hl-1">(</span><span class="hl-4">`Batch complete: </span><span class="hl-0">${</span><span class="hl-7">count</span><span class="hl-0">}</span><span class="hl-4"> CAPTCHAs in </span><span class="hl-0">${</span><span class="hl-7">duration</span><span class="hl-0">}</span><span class="hl-4">ms`</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-5">// Save metadata</span><br/><span class="hl-1">    </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">metadata</span><span class="hl-1"> = {</span><br/><span class="hl-1">        </span><span class="hl-7">count</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-7">duration</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-7">averageTime:</span><span class="hl-1"> </span><span class="hl-7">duration</span><span class="hl-1"> / </span><span class="hl-7">count</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-7">captchas</span><br/><span class="hl-1">    };</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-7">fs</span><span class="hl-1">.</span><span class="hl-3">writeFileSync</span><span class="hl-1">(</span><br/><span class="hl-1">        </span><span class="hl-7">path</span><span class="hl-1">.</span><span class="hl-3">join</span><span class="hl-1">(</span><span class="hl-7">outputDir</span><span class="hl-1">, </span><span class="hl-4">&#39;metadata.json&#39;</span><span class="hl-1">), </span><br/><span class="hl-1">        </span><span class="hl-2">JSON</span><span class="hl-1">.</span><span class="hl-3">stringify</span><span class="hl-1">(</span><span class="hl-7">metadata</span><span class="hl-1">, </span><span class="hl-0">null</span><span class="hl-1">, </span><span class="hl-6">2</span><span class="hl-1">)</span><br/><span class="hl-1">    );</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-8">return</span><span class="hl-1"> </span><span class="hl-7">metadata</span><span class="hl-1">;</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-5">// Generate 100 CAPTCHAs</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">batch</span><span class="hl-1"> = </span><span class="hl-3">generateCaptchaBatch</span><span class="hl-1">(</span><span class="hl-6">100</span><span class="hl-1">);</span><br/><span class="hl-7">console</span><span class="hl-1">.</span><span class="hl-3">log</span><span class="hl-1">(</span><span class="hl-4">`Average generation time: </span><span class="hl-0">${</span><span class="hl-7">batch</span><span class="hl-10">.</span><span class="hl-7">averageTime</span><span class="hl-10">.</span><span class="hl-3">toFixed</span><span class="hl-10">(</span><span class="hl-6">2</span><span class="hl-10">)</span><span class="hl-0">}</span><span class="hl-4">ms`</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<h2 id="error-handling" class="tsd-anchor-link">Error Handling<a href="#error-handling" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><h3 id="comprehensive-error-handling" class="tsd-anchor-link">Comprehensive Error Handling<a href="#comprehensive-error-handling" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="javascript"><span class="hl-0">const</span><span class="hl-1"> { </span><span class="hl-2">CaptchaGenerator</span><span class="hl-1">, </span><span class="hl-2">createCaptchaSync</span><span class="hl-1"> } = </span><span class="hl-3">require</span><span class="hl-1">(</span><span class="hl-4">&quot;captcha-canvas&quot;</span><span class="hl-1">);</span><br/><br/><span class="hl-0">class</span><span class="hl-1"> </span><span class="hl-9">CaptchaService</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">constructor</span><span class="hl-1">() {</span><br/><span class="hl-1">        </span><span class="hl-0">this</span><span class="hl-1">.</span><span class="hl-7">fallbackEnabled</span><span class="hl-1"> = </span><span class="hl-0">true</span><span class="hl-1">;</span><br/><span class="hl-1">        </span><span class="hl-0">this</span><span class="hl-1">.</span><span class="hl-7">retryAttempts</span><span class="hl-1"> = </span><span class="hl-6">3</span><span class="hl-1">;</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-0">async</span><span class="hl-1"> </span><span class="hl-3">generateRobustCaptcha</span><span class="hl-1">(</span><span class="hl-7">config</span><span class="hl-1"> = {}) {</span><br/><span class="hl-1">        </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">attempts</span><span class="hl-1"> = [];</span><br/><span class="hl-1">        </span><br/><span class="hl-1">        </span><span class="hl-5">// Primary generation attempt</span><br/><span class="hl-1">        </span><span class="hl-8">for</span><span class="hl-1"> (</span><span class="hl-0">let</span><span class="hl-1"> </span><span class="hl-7">attempt</span><span class="hl-1"> = </span><span class="hl-6">1</span><span class="hl-1">; </span><span class="hl-7">attempt</span><span class="hl-1"> &lt;= </span><span class="hl-0">this</span><span class="hl-1">.</span><span class="hl-7">retryAttempts</span><span class="hl-1">; </span><span class="hl-7">attempt</span><span class="hl-1">++) {</span><br/><span class="hl-1">            </span><span class="hl-8">try</span><span class="hl-1"> {</span><br/><span class="hl-1">                </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">captcha</span><span class="hl-1"> = </span><span class="hl-0">new</span><span class="hl-1"> </span><span class="hl-3">CaptchaGenerator</span><span class="hl-1">(</span><span class="hl-7">config</span><span class="hl-1">.</span><span class="hl-7">dimensions</span><span class="hl-1">)</span><br/><span class="hl-1">                    .</span><span class="hl-3">setCaptcha</span><span class="hl-1">(</span><span class="hl-7">config</span><span class="hl-1">.</span><span class="hl-7">captcha</span><span class="hl-1"> || { </span><span class="hl-7">characters:</span><span class="hl-1"> </span><span class="hl-6">6</span><span class="hl-1"> })</span><br/><span class="hl-1">                    .</span><span class="hl-3">setTrace</span><span class="hl-1">(</span><span class="hl-7">config</span><span class="hl-1">.</span><span class="hl-7">trace</span><span class="hl-1"> || {})</span><br/><span class="hl-1">                    .</span><span class="hl-3">setDecoy</span><span class="hl-1">(</span><span class="hl-7">config</span><span class="hl-1">.</span><span class="hl-7">decoy</span><span class="hl-1"> || {});</span><br/><span class="hl-1">                </span><br/><span class="hl-1">                </span><span class="hl-8">if</span><span class="hl-1"> (</span><span class="hl-7">config</span><span class="hl-1">.</span><span class="hl-7">background</span><span class="hl-1">) {</span><br/><span class="hl-1">                    </span><span class="hl-7">captcha</span><span class="hl-1">.</span><span class="hl-3">setBackground</span><span class="hl-1">(</span><span class="hl-7">config</span><span class="hl-1">.</span><span class="hl-7">background</span><span class="hl-1">);</span><br/><span class="hl-1">                }</span><br/><span class="hl-1">                </span><br/><span class="hl-1">                </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">buffer</span><span class="hl-1"> = </span><span class="hl-8">await</span><span class="hl-1"> </span><span class="hl-7">captcha</span><span class="hl-1">.</span><span class="hl-3">generate</span><span class="hl-1">();</span><br/><span class="hl-1">                </span><br/><span class="hl-1">                </span><span class="hl-8">return</span><span class="hl-1"> {</span><br/><span class="hl-1">                    </span><span class="hl-7">success:</span><span class="hl-1"> </span><span class="hl-0">true</span><span class="hl-1">,</span><br/><span class="hl-1">                    </span><span class="hl-7">buffer</span><span class="hl-1">,</span><br/><span class="hl-1">                    </span><span class="hl-7">text:</span><span class="hl-1"> </span><span class="hl-7">captcha</span><span class="hl-1">.</span><span class="hl-7">text</span><span class="hl-1">,</span><br/><span class="hl-1">                    </span><span class="hl-7">method:</span><span class="hl-1"> </span><span class="hl-4">&#39;primary&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">                    </span><span class="hl-7">attempt</span><br/><span class="hl-1">                };</span><br/><span class="hl-1">            } </span><span class="hl-8">catch</span><span class="hl-1"> (</span><span class="hl-7">error</span><span class="hl-1">) {</span><br/><span class="hl-1">                </span><span class="hl-7">attempts</span><span class="hl-1">.</span><span class="hl-3">push</span><span class="hl-1">({</span><br/><span class="hl-1">                    </span><span class="hl-7">attempt</span><span class="hl-1">,</span><br/><span class="hl-1">                    </span><span class="hl-7">error:</span><span class="hl-1"> </span><span class="hl-7">error</span><span class="hl-1">.</span><span class="hl-7">message</span><span class="hl-1">,</span><br/><span class="hl-1">                    </span><span class="hl-7">timestamp:</span><span class="hl-1"> </span><span class="hl-0">new</span><span class="hl-1"> </span><span class="hl-3">Date</span><span class="hl-1">().</span><span class="hl-3">toISOString</span><span class="hl-1">()</span><br/><span class="hl-1">                });</span><br/><span class="hl-1">                </span><br/><span class="hl-1">                </span><span class="hl-7">console</span><span class="hl-1">.</span><span class="hl-3">warn</span><span class="hl-1">(</span><span class="hl-4">`Attempt </span><span class="hl-0">${</span><span class="hl-7">attempt</span><span class="hl-0">}</span><span class="hl-4"> failed:`</span><span class="hl-1">, </span><span class="hl-7">error</span><span class="hl-1">.</span><span class="hl-7">message</span><span class="hl-1">);</span><br/><span class="hl-1">                </span><br/><span class="hl-1">                </span><span class="hl-5">// Wait before retry (exponential backoff)</span><br/><span class="hl-1">                </span><span class="hl-8">if</span><span class="hl-1"> (</span><span class="hl-7">attempt</span><span class="hl-1"> &lt; </span><span class="hl-0">this</span><span class="hl-1">.</span><span class="hl-7">retryAttempts</span><span class="hl-1">) {</span><br/><span class="hl-1">                    </span><span class="hl-8">await</span><span class="hl-1"> </span><span class="hl-0">new</span><span class="hl-1"> </span><span class="hl-9">Promise</span><span class="hl-1">(</span><span class="hl-7">resolve</span><span class="hl-1"> </span><span class="hl-0">=&gt;</span><span class="hl-1"> </span><br/><span class="hl-1">                        </span><span class="hl-3">setTimeout</span><span class="hl-1">(</span><span class="hl-7">resolve</span><span class="hl-1">, </span><span class="hl-7">Math</span><span class="hl-1">.</span><span class="hl-3">pow</span><span class="hl-1">(</span><span class="hl-6">2</span><span class="hl-1">, </span><span class="hl-7">attempt</span><span class="hl-1">) * </span><span class="hl-6">100</span><span class="hl-1">)</span><br/><span class="hl-1">                    );</span><br/><span class="hl-1">                }</span><br/><span class="hl-1">            }</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">        </span><br/><span class="hl-1">        </span><span class="hl-5">// Fallback to synchronous generation</span><br/><span class="hl-1">        </span><span class="hl-8">if</span><span class="hl-1"> (</span><span class="hl-0">this</span><span class="hl-1">.</span><span class="hl-7">fallbackEnabled</span><span class="hl-1">) {</span><br/><span class="hl-1">            </span><span class="hl-8">try</span><span class="hl-1"> {</span><br/><span class="hl-1">                </span><span class="hl-7">console</span><span class="hl-1">.</span><span class="hl-3">log</span><span class="hl-1">(</span><span class="hl-4">&#39;Falling back to synchronous generation&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">                </span><br/><span class="hl-1">                </span><span class="hl-0">const</span><span class="hl-1"> { </span><span class="hl-2">image</span><span class="hl-1">, </span><span class="hl-2">text</span><span class="hl-1"> } = </span><span class="hl-3">createCaptchaSync</span><span class="hl-1">(</span><br/><span class="hl-1">                    </span><span class="hl-7">config</span><span class="hl-1">.</span><span class="hl-7">dimensions</span><span class="hl-1">?.</span><span class="hl-7">width</span><span class="hl-1"> || </span><span class="hl-6">300</span><span class="hl-1">,</span><br/><span class="hl-1">                    </span><span class="hl-7">config</span><span class="hl-1">.</span><span class="hl-7">dimensions</span><span class="hl-1">?.</span><span class="hl-7">height</span><span class="hl-1"> || </span><span class="hl-6">100</span><span class="hl-1">,</span><br/><span class="hl-1">                    {</span><br/><span class="hl-1">                        </span><span class="hl-7">captcha:</span><span class="hl-1"> </span><span class="hl-7">config</span><span class="hl-1">.</span><span class="hl-7">captcha</span><span class="hl-1"> || { </span><span class="hl-7">characters:</span><span class="hl-1"> </span><span class="hl-6">6</span><span class="hl-1"> },</span><br/><span class="hl-1">                        </span><span class="hl-7">trace:</span><span class="hl-1"> </span><span class="hl-7">config</span><span class="hl-1">.</span><span class="hl-7">trace</span><span class="hl-1"> || {},</span><br/><span class="hl-1">                        </span><span class="hl-7">decoy:</span><span class="hl-1"> </span><span class="hl-7">config</span><span class="hl-1">.</span><span class="hl-7">decoy</span><span class="hl-1"> || {}</span><br/><span class="hl-1">                    }</span><br/><span class="hl-1">                );</span><br/><span class="hl-1">                </span><br/><span class="hl-1">                </span><span class="hl-8">return</span><span class="hl-1"> {</span><br/><span class="hl-1">                    </span><span class="hl-7">success:</span><span class="hl-1"> </span><span class="hl-0">true</span><span class="hl-1">,</span><br/><span class="hl-1">                    </span><span class="hl-7">buffer:</span><span class="hl-1"> </span><span class="hl-7">image</span><span class="hl-1">,</span><br/><span class="hl-1">                    </span><span class="hl-7">text</span><span class="hl-1">,</span><br/><span class="hl-1">                    </span><span class="hl-7">method:</span><span class="hl-1"> </span><span class="hl-4">&#39;fallback&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">                    </span><span class="hl-7">attempts</span><br/><span class="hl-1">                };</span><br/><span class="hl-1">            } </span><span class="hl-8">catch</span><span class="hl-1"> (</span><span class="hl-7">fallbackError</span><span class="hl-1">) {</span><br/><span class="hl-1">                </span><span class="hl-7">attempts</span><span class="hl-1">.</span><span class="hl-3">push</span><span class="hl-1">({</span><br/><span class="hl-1">                    </span><span class="hl-7">method:</span><span class="hl-1"> </span><span class="hl-4">&#39;fallback&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">                    </span><span class="hl-7">error:</span><span class="hl-1"> </span><span class="hl-7">fallbackError</span><span class="hl-1">.</span><span class="hl-7">message</span><span class="hl-1">,</span><br/><span class="hl-1">                    </span><span class="hl-7">timestamp:</span><span class="hl-1"> </span><span class="hl-0">new</span><span class="hl-1"> </span><span class="hl-3">Date</span><span class="hl-1">().</span><span class="hl-3">toISOString</span><span class="hl-1">()</span><br/><span class="hl-1">                });</span><br/><span class="hl-1">            }</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">        </span><br/><span class="hl-1">        </span><span class="hl-5">// Complete failure</span><br/><span class="hl-1">        </span><span class="hl-8">return</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-7">success:</span><span class="hl-1"> </span><span class="hl-0">false</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-7">error:</span><span class="hl-1"> </span><span class="hl-4">&#39;All generation attempts failed&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-7">attempts</span><br/><span class="hl-1">        };</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-5">// Usage</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">service</span><span class="hl-1"> = </span><span class="hl-0">new</span><span class="hl-1"> </span><span class="hl-3">CaptchaService</span><span class="hl-1">();</span><br/><br/><span class="hl-0">async</span><span class="hl-1"> </span><span class="hl-0">function</span><span class="hl-1"> </span><span class="hl-3">handleCaptchaRequest</span><span class="hl-1">(</span><span class="hl-7">req</span><span class="hl-1">, </span><span class="hl-7">res</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-8">try</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">result</span><span class="hl-1"> = </span><span class="hl-8">await</span><span class="hl-1"> </span><span class="hl-7">service</span><span class="hl-1">.</span><span class="hl-3">generateRobustCaptcha</span><span class="hl-1">({</span><br/><span class="hl-1">            </span><span class="hl-7">dimensions:</span><span class="hl-1"> { </span><span class="hl-7">width:</span><span class="hl-1"> </span><span class="hl-6">300</span><span class="hl-1">, </span><span class="hl-7">height:</span><span class="hl-1"> </span><span class="hl-6">100</span><span class="hl-1"> },</span><br/><span class="hl-1">            </span><span class="hl-7">captcha:</span><span class="hl-1"> { </span><span class="hl-7">characters:</span><span class="hl-1"> </span><span class="hl-6">6</span><span class="hl-1">, </span><span class="hl-7">size:</span><span class="hl-1"> </span><span class="hl-6">40</span><span class="hl-1"> },</span><br/><span class="hl-1">            </span><span class="hl-7">trace:</span><span class="hl-1"> { </span><span class="hl-7">size:</span><span class="hl-1"> </span><span class="hl-6">3</span><span class="hl-1"> },</span><br/><span class="hl-1">            </span><span class="hl-7">decoy:</span><span class="hl-1"> { </span><span class="hl-7">total:</span><span class="hl-1"> </span><span class="hl-6">25</span><span class="hl-1">, </span><span class="hl-7">opacity:</span><span class="hl-1"> </span><span class="hl-6">0.3</span><span class="hl-1"> }</span><br/><span class="hl-1">        });</span><br/><span class="hl-1">        </span><br/><span class="hl-1">        </span><span class="hl-8">if</span><span class="hl-1"> (</span><span class="hl-7">result</span><span class="hl-1">.</span><span class="hl-7">success</span><span class="hl-1">) {</span><br/><span class="hl-1">            </span><span class="hl-7">req</span><span class="hl-1">.</span><span class="hl-7">session</span><span class="hl-1">.</span><span class="hl-7">captcha</span><span class="hl-1"> = </span><span class="hl-7">result</span><span class="hl-1">.</span><span class="hl-7">text</span><span class="hl-1">;</span><br/><span class="hl-1">            </span><span class="hl-7">res</span><span class="hl-1">.</span><span class="hl-3">type</span><span class="hl-1">(</span><span class="hl-4">&#39;png&#39;</span><span class="hl-1">).</span><span class="hl-3">send</span><span class="hl-1">(</span><span class="hl-7">result</span><span class="hl-1">.</span><span class="hl-7">buffer</span><span class="hl-1">);</span><br/><span class="hl-1">        } </span><span class="hl-8">else</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-7">console</span><span class="hl-1">.</span><span class="hl-3">error</span><span class="hl-1">(</span><span class="hl-4">&#39;CAPTCHA generation failed:&#39;</span><span class="hl-1">, </span><span class="hl-7">result</span><span class="hl-1">);</span><br/><span class="hl-1">            </span><span class="hl-7">res</span><span class="hl-1">.</span><span class="hl-3">status</span><span class="hl-1">(</span><span class="hl-6">500</span><span class="hl-1">).</span><span class="hl-3">json</span><span class="hl-1">({ </span><br/><span class="hl-1">                </span><span class="hl-7">error:</span><span class="hl-1"> </span><span class="hl-4">&#39;CAPTCHA generation failed&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">                </span><span class="hl-7">details:</span><span class="hl-1"> </span><span class="hl-7">result</span><span class="hl-1">.</span><span class="hl-7">attempts</span><span class="hl-1"> </span><br/><span class="hl-1">            });</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">    } </span><span class="hl-8">catch</span><span class="hl-1"> (</span><span class="hl-7">error</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-7">console</span><span class="hl-1">.</span><span class="hl-3">error</span><span class="hl-1">(</span><span class="hl-4">&#39;CAPTCHA request error:&#39;</span><span class="hl-1">, </span><span class="hl-7">error</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-7">res</span><span class="hl-1">.</span><span class="hl-3">status</span><span class="hl-1">(</span><span class="hl-6">500</span><span class="hl-1">).</span><span class="hl-3">json</span><span class="hl-1">({ </span><span class="hl-7">error:</span><span class="hl-1"> </span><span class="hl-4">&#39;Internal server error&#39;</span><span class="hl-1"> });</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<h2 id="testing" class="tsd-anchor-link">Testing<a href="#testing" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><h3 id="comprehensive-test-suite" class="tsd-anchor-link">Comprehensive Test Suite<a href="#comprehensive-test-suite" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="javascript"><span class="hl-0">const</span><span class="hl-1"> { </span><span class="hl-2">createCaptcha</span><span class="hl-1">, </span><span class="hl-2">createCaptchaSync</span><span class="hl-1">, </span><span class="hl-2">CaptchaGenerator</span><span class="hl-1"> } = </span><span class="hl-3">require</span><span class="hl-1">(</span><span class="hl-4">&quot;captcha-canvas&quot;</span><span class="hl-1">);</span><br/><br/><span class="hl-3">describe</span><span class="hl-1">(</span><span class="hl-4">&quot;CAPTCHA Generation Tests&quot;</span><span class="hl-1">, () </span><span class="hl-0">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-3">describe</span><span class="hl-1">(</span><span class="hl-4">&quot;Basic Functionality&quot;</span><span class="hl-1">, () </span><span class="hl-0">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-3">test</span><span class="hl-1">(</span><span class="hl-4">&quot;should generate CAPTCHA with correct format&quot;</span><span class="hl-1">, </span><span class="hl-0">async</span><span class="hl-1"> () </span><span class="hl-0">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-0">const</span><span class="hl-1"> { </span><span class="hl-2">image</span><span class="hl-1">, </span><span class="hl-2">text</span><span class="hl-1"> } = </span><span class="hl-3">createCaptcha</span><span class="hl-1">(</span><span class="hl-6">300</span><span class="hl-1">, </span><span class="hl-6">100</span><span class="hl-1">);</span><br/><span class="hl-1">            </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">buffer</span><span class="hl-1"> = </span><span class="hl-8">await</span><span class="hl-1"> </span><span class="hl-7">image</span><span class="hl-1">;</span><br/><span class="hl-1">            </span><br/><span class="hl-1">            </span><span class="hl-3">expect</span><span class="hl-1">(</span><span class="hl-7">buffer</span><span class="hl-1">).</span><span class="hl-3">toBeInstanceOf</span><span class="hl-1">(</span><span class="hl-7">Buffer</span><span class="hl-1">);</span><br/><span class="hl-1">            </span><span class="hl-3">expect</span><span class="hl-1">(</span><span class="hl-7">buffer</span><span class="hl-1">.</span><span class="hl-7">length</span><span class="hl-1">).</span><span class="hl-3">toBeGreaterThan</span><span class="hl-1">(</span><span class="hl-6">0</span><span class="hl-1">);</span><br/><span class="hl-1">            </span><span class="hl-3">expect</span><span class="hl-1">(</span><span class="hl-7">text</span><span class="hl-1">).</span><span class="hl-3">toMatch</span><span class="hl-1">(</span><span class="hl-11">/</span><span class="hl-12">^</span><span class="hl-13">[</span><span class="hl-11">A-F0-9</span><span class="hl-13">]</span><span class="hl-14">+</span><span class="hl-12">$</span><span class="hl-11">/</span><span class="hl-1">);</span><br/><span class="hl-1">            </span><span class="hl-3">expect</span><span class="hl-1">(</span><span class="hl-7">text</span><span class="hl-1">.</span><span class="hl-7">length</span><span class="hl-1">).</span><span class="hl-3">toBeGreaterThan</span><span class="hl-1">(</span><span class="hl-6">0</span><span class="hl-1">);</span><br/><span class="hl-1">        });</span><br/><span class="hl-1">        </span><br/><span class="hl-1">        </span><span class="hl-3">test</span><span class="hl-1">(</span><span class="hl-4">&quot;should generate synchronous CAPTCHA&quot;</span><span class="hl-1">, () </span><span class="hl-0">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-0">const</span><span class="hl-1"> { </span><span class="hl-2">image</span><span class="hl-1">, </span><span class="hl-2">text</span><span class="hl-1"> } = </span><span class="hl-3">createCaptchaSync</span><span class="hl-1">(</span><span class="hl-6">300</span><span class="hl-1">, </span><span class="hl-6">100</span><span class="hl-1">);</span><br/><span class="hl-1">            </span><br/><span class="hl-1">            </span><span class="hl-3">expect</span><span class="hl-1">(</span><span class="hl-7">image</span><span class="hl-1">).</span><span class="hl-3">toBeInstanceOf</span><span class="hl-1">(</span><span class="hl-7">Buffer</span><span class="hl-1">);</span><br/><span class="hl-1">            </span><span class="hl-3">expect</span><span class="hl-1">(</span><span class="hl-7">text</span><span class="hl-1">).</span><span class="hl-3">toMatch</span><span class="hl-1">(</span><span class="hl-11">/</span><span class="hl-12">^</span><span class="hl-13">[</span><span class="hl-11">A-F0-9</span><span class="hl-13">]</span><span class="hl-14">+</span><span class="hl-12">$</span><span class="hl-11">/</span><span class="hl-1">);</span><br/><span class="hl-1">        });</span><br/><span class="hl-1">        </span><br/><span class="hl-1">        </span><span class="hl-3">test</span><span class="hl-1">(</span><span class="hl-4">&quot;should respect custom dimensions&quot;</span><span class="hl-1">, </span><span class="hl-0">async</span><span class="hl-1"> () </span><span class="hl-0">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-0">const</span><span class="hl-1"> { </span><span class="hl-2">image</span><span class="hl-1"> } = </span><span class="hl-3">createCaptcha</span><span class="hl-1">(</span><span class="hl-6">400</span><span class="hl-1">, </span><span class="hl-6">200</span><span class="hl-1">);</span><br/><span class="hl-1">            </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">buffer</span><span class="hl-1"> = </span><span class="hl-8">await</span><span class="hl-1"> </span><span class="hl-7">image</span><span class="hl-1">;</span><br/><span class="hl-1">            </span><br/><span class="hl-1">            </span><span class="hl-5">// PNG signature check</span><br/><span class="hl-1">            </span><span class="hl-3">expect</span><span class="hl-1">(</span><span class="hl-7">buffer</span><span class="hl-1">.</span><span class="hl-3">slice</span><span class="hl-1">(</span><span class="hl-6">0</span><span class="hl-1">, </span><span class="hl-6">8</span><span class="hl-1">)).</span><span class="hl-3">toEqual</span><span class="hl-1">(</span><br/><span class="hl-1">                </span><span class="hl-7">Buffer</span><span class="hl-1">.</span><span class="hl-3">from</span><span class="hl-1">([</span><span class="hl-6">137</span><span class="hl-1">, </span><span class="hl-6">80</span><span class="hl-1">, </span><span class="hl-6">78</span><span class="hl-1">, </span><span class="hl-6">71</span><span class="hl-1">, </span><span class="hl-6">13</span><span class="hl-1">, </span><span class="hl-6">10</span><span class="hl-1">, </span><span class="hl-6">26</span><span class="hl-1">, </span><span class="hl-6">10</span><span class="hl-1">])</span><br/><span class="hl-1">            );</span><br/><span class="hl-1">        });</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-3">describe</span><span class="hl-1">(</span><span class="hl-4">&quot;CaptchaGenerator Class&quot;</span><span class="hl-1">, () </span><span class="hl-0">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-3">test</span><span class="hl-1">(</span><span class="hl-4">&quot;should create instance with default dimensions&quot;</span><span class="hl-1">, () </span><span class="hl-0">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">captcha</span><span class="hl-1"> = </span><span class="hl-0">new</span><span class="hl-1"> </span><span class="hl-3">CaptchaGenerator</span><span class="hl-1">();</span><br/><span class="hl-1">            </span><span class="hl-3">expect</span><span class="hl-1">(</span><span class="hl-7">captcha</span><span class="hl-1">).</span><span class="hl-3">toBeInstanceOf</span><span class="hl-1">(</span><span class="hl-7">CaptchaGenerator</span><span class="hl-1">);</span><br/><span class="hl-1">        });</span><br/><span class="hl-1">        </span><br/><span class="hl-1">        </span><span class="hl-3">test</span><span class="hl-1">(</span><span class="hl-4">&quot;should handle method chaining&quot;</span><span class="hl-1">, </span><span class="hl-0">async</span><span class="hl-1"> () </span><span class="hl-0">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">captcha</span><span class="hl-1"> = </span><span class="hl-0">new</span><span class="hl-1"> </span><span class="hl-3">CaptchaGenerator</span><span class="hl-1">()</span><br/><span class="hl-1">                .</span><span class="hl-3">setDimension</span><span class="hl-1">(</span><span class="hl-6">350</span><span class="hl-1">, </span><span class="hl-6">120</span><span class="hl-1">)</span><br/><span class="hl-1">                .</span><span class="hl-3">setCaptcha</span><span class="hl-1">({ </span><span class="hl-7">text:</span><span class="hl-1"> </span><span class="hl-4">&quot;TEST123&quot;</span><span class="hl-1"> })</span><br/><span class="hl-1">                .</span><span class="hl-3">setTrace</span><span class="hl-1">({ </span><span class="hl-7">color:</span><span class="hl-1"> </span><span class="hl-4">&quot;#ff0000&quot;</span><span class="hl-1"> });</span><br/><span class="hl-1">            </span><br/><span class="hl-1">            </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">buffer</span><span class="hl-1"> = </span><span class="hl-8">await</span><span class="hl-1"> </span><span class="hl-7">captcha</span><span class="hl-1">.</span><span class="hl-3">generate</span><span class="hl-1">();</span><br/><span class="hl-1">            </span><span class="hl-3">expect</span><span class="hl-1">(</span><span class="hl-7">buffer</span><span class="hl-1">).</span><span class="hl-3">toBeInstanceOf</span><span class="hl-1">(</span><span class="hl-7">Buffer</span><span class="hl-1">);</span><br/><span class="hl-1">            </span><span class="hl-3">expect</span><span class="hl-1">(</span><span class="hl-7">captcha</span><span class="hl-1">.</span><span class="hl-7">text</span><span class="hl-1">).</span><span class="hl-3">toBe</span><span class="hl-1">(</span><span class="hl-4">&quot;TEST123&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">        });</span><br/><span class="hl-1">        </span><br/><span class="hl-1">        </span><span class="hl-3">test</span><span class="hl-1">(</span><span class="hl-4">&quot;should generate random text when characters specified&quot;</span><span class="hl-1">, </span><span class="hl-0">async</span><span class="hl-1"> () </span><span class="hl-0">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">captcha</span><span class="hl-1"> = </span><span class="hl-0">new</span><span class="hl-1"> </span><span class="hl-3">CaptchaGenerator</span><span class="hl-1">()</span><br/><span class="hl-1">                .</span><span class="hl-3">setCaptcha</span><span class="hl-1">({ </span><span class="hl-7">characters:</span><span class="hl-1"> </span><span class="hl-6">8</span><span class="hl-1"> });</span><br/><span class="hl-1">            </span><br/><span class="hl-1">            </span><span class="hl-8">await</span><span class="hl-1"> </span><span class="hl-7">captcha</span><span class="hl-1">.</span><span class="hl-3">generate</span><span class="hl-1">();</span><br/><span class="hl-1">            </span><span class="hl-3">expect</span><span class="hl-1">(</span><span class="hl-7">captcha</span><span class="hl-1">.</span><span class="hl-7">text</span><span class="hl-1">).</span><span class="hl-3">toHaveLength</span><span class="hl-1">(</span><span class="hl-6">8</span><span class="hl-1">);</span><br/><span class="hl-1">            </span><span class="hl-3">expect</span><span class="hl-1">(</span><span class="hl-7">captcha</span><span class="hl-1">.</span><span class="hl-7">text</span><span class="hl-1">).</span><span class="hl-3">toMatch</span><span class="hl-1">(</span><span class="hl-11">/</span><span class="hl-12">^</span><span class="hl-13">[</span><span class="hl-11">A-F0-9</span><span class="hl-13">]</span><span class="hl-14">+</span><span class="hl-12">$</span><span class="hl-11">/</span><span class="hl-1">);</span><br/><span class="hl-1">        });</span><br/><span class="hl-1">        </span><br/><span class="hl-1">        </span><span class="hl-3">test</span><span class="hl-1">(</span><span class="hl-4">&quot;should handle multi-styled text arrays&quot;</span><span class="hl-1">, </span><span class="hl-0">async</span><span class="hl-1"> () </span><span class="hl-0">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">captcha</span><span class="hl-1"> = </span><span class="hl-0">new</span><span class="hl-1"> </span><span class="hl-3">CaptchaGenerator</span><span class="hl-1">()</span><br/><span class="hl-1">                .</span><span class="hl-3">setCaptcha</span><span class="hl-1">([</span><br/><span class="hl-1">                    { </span><span class="hl-7">text:</span><span class="hl-1"> </span><span class="hl-4">&quot;HE&quot;</span><span class="hl-1">, </span><span class="hl-7">color:</span><span class="hl-1"> </span><span class="hl-4">&quot;#ff0000&quot;</span><span class="hl-1"> },</span><br/><span class="hl-1">                    { </span><span class="hl-7">text:</span><span class="hl-1"> </span><span class="hl-4">&quot;LLO&quot;</span><span class="hl-1">, </span><span class="hl-7">color:</span><span class="hl-1"> </span><span class="hl-4">&quot;#00ff00&quot;</span><span class="hl-1"> }</span><br/><span class="hl-1">                ]);</span><br/><span class="hl-1">            </span><br/><span class="hl-1">            </span><span class="hl-8">await</span><span class="hl-1"> </span><span class="hl-7">captcha</span><span class="hl-1">.</span><span class="hl-3">generate</span><span class="hl-1">();</span><br/><span class="hl-1">            </span><span class="hl-3">expect</span><span class="hl-1">(</span><span class="hl-7">captcha</span><span class="hl-1">.</span><span class="hl-7">text</span><span class="hl-1">).</span><span class="hl-3">toBe</span><span class="hl-1">(</span><span class="hl-4">&quot;HELLO&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">        });</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-3">describe</span><span class="hl-1">(</span><span class="hl-4">&quot;Configuration Validation&quot;</span><span class="hl-1">, () </span><span class="hl-0">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-3">test</span><span class="hl-1">(</span><span class="hl-4">&quot;should handle invalid dimensions gracefully&quot;</span><span class="hl-1">, () </span><span class="hl-0">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-3">expect</span><span class="hl-1">(() </span><span class="hl-0">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">                </span><span class="hl-0">new</span><span class="hl-1"> </span><span class="hl-3">CaptchaGenerator</span><span class="hl-1">({ </span><span class="hl-7">width:</span><span class="hl-1"> -</span><span class="hl-6">100</span><span class="hl-1">, </span><span class="hl-7">height:</span><span class="hl-1"> -</span><span class="hl-6">50</span><span class="hl-1"> });</span><br/><span class="hl-1">            }).</span><span class="hl-7">not</span><span class="hl-1">.</span><span class="hl-3">toThrow</span><span class="hl-1">();</span><br/><span class="hl-1">        });</span><br/><span class="hl-1">        </span><br/><span class="hl-1">        </span><span class="hl-3">test</span><span class="hl-1">(</span><span class="hl-4">&quot;should throw error for array captcha without text&quot;</span><span class="hl-1">, () </span><span class="hl-0">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-3">expect</span><span class="hl-1">(() </span><span class="hl-0">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">                </span><span class="hl-0">new</span><span class="hl-1"> </span><span class="hl-3">CaptchaGenerator</span><span class="hl-1">().</span><span class="hl-3">setCaptcha</span><span class="hl-1">([</span><br/><span class="hl-1">                    { </span><span class="hl-7">size:</span><span class="hl-1"> </span><span class="hl-6">40</span><span class="hl-1"> }, </span><span class="hl-5">// Missing text property</span><br/><span class="hl-1">                    { </span><span class="hl-7">text:</span><span class="hl-1"> </span><span class="hl-4">&quot;WORLD&quot;</span><span class="hl-1"> }</span><br/><span class="hl-1">                ]);</span><br/><span class="hl-1">            }).</span><span class="hl-3">toThrow</span><span class="hl-1">(</span><span class="hl-4">&quot;Each captcha option in array must have a text property.&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">        });</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-3">describe</span><span class="hl-1">(</span><span class="hl-4">&quot;Performance Tests&quot;</span><span class="hl-1">, () </span><span class="hl-0">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-3">test</span><span class="hl-1">(</span><span class="hl-4">&quot;should generate CAPTCHA within reasonable time&quot;</span><span class="hl-1">, </span><span class="hl-0">async</span><span class="hl-1"> () </span><span class="hl-0">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">startTime</span><span class="hl-1"> = </span><span class="hl-7">Date</span><span class="hl-1">.</span><span class="hl-3">now</span><span class="hl-1">();</span><br/><span class="hl-1">            </span><span class="hl-0">const</span><span class="hl-1"> { </span><span class="hl-2">image</span><span class="hl-1"> } = </span><span class="hl-3">createCaptcha</span><span class="hl-1">(</span><span class="hl-6">300</span><span class="hl-1">, </span><span class="hl-6">100</span><span class="hl-1">);</span><br/><span class="hl-1">            </span><span class="hl-8">await</span><span class="hl-1"> </span><span class="hl-7">image</span><span class="hl-1">;</span><br/><span class="hl-1">            </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">duration</span><span class="hl-1"> = </span><span class="hl-7">Date</span><span class="hl-1">.</span><span class="hl-3">now</span><span class="hl-1">() - </span><span class="hl-7">startTime</span><span class="hl-1">;</span><br/><span class="hl-1">            </span><br/><span class="hl-1">            </span><span class="hl-3">expect</span><span class="hl-1">(</span><span class="hl-7">duration</span><span class="hl-1">).</span><span class="hl-3">toBeLessThan</span><span class="hl-1">(</span><span class="hl-6">1000</span><span class="hl-1">); </span><span class="hl-5">// Should complete within 1 second</span><br/><span class="hl-1">        });</span><br/><span class="hl-1">        </span><br/><span class="hl-1">        </span><span class="hl-3">test</span><span class="hl-1">(</span><span class="hl-4">&quot;should handle batch generation efficiently&quot;</span><span class="hl-1">, () </span><span class="hl-0">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">startTime</span><span class="hl-1"> = </span><span class="hl-7">Date</span><span class="hl-1">.</span><span class="hl-3">now</span><span class="hl-1">();</span><br/><span class="hl-1">            </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">results</span><span class="hl-1"> = [];</span><br/><span class="hl-1">            </span><br/><span class="hl-1">            </span><span class="hl-8">for</span><span class="hl-1"> (</span><span class="hl-0">let</span><span class="hl-1"> </span><span class="hl-7">i</span><span class="hl-1"> = </span><span class="hl-6">0</span><span class="hl-1">; </span><span class="hl-7">i</span><span class="hl-1"> &lt; </span><span class="hl-6">10</span><span class="hl-1">; </span><span class="hl-7">i</span><span class="hl-1">++) {</span><br/><span class="hl-1">                </span><span class="hl-0">const</span><span class="hl-1"> { </span><span class="hl-2">image</span><span class="hl-1">, </span><span class="hl-2">text</span><span class="hl-1"> } = </span><span class="hl-3">createCaptchaSync</span><span class="hl-1">(</span><span class="hl-6">300</span><span class="hl-1">, </span><span class="hl-6">100</span><span class="hl-1">);</span><br/><span class="hl-1">                </span><span class="hl-7">results</span><span class="hl-1">.</span><span class="hl-3">push</span><span class="hl-1">({ </span><span class="hl-7">image</span><span class="hl-1">, </span><span class="hl-7">text</span><span class="hl-1"> });</span><br/><span class="hl-1">            }</span><br/><span class="hl-1">            </span><br/><span class="hl-1">            </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">duration</span><span class="hl-1"> = </span><span class="hl-7">Date</span><span class="hl-1">.</span><span class="hl-3">now</span><span class="hl-1">() - </span><span class="hl-7">startTime</span><span class="hl-1">;</span><br/><span class="hl-1">            </span><span class="hl-3">expect</span><span class="hl-1">(</span><span class="hl-7">results</span><span class="hl-1">).</span><span class="hl-3">toHaveLength</span><span class="hl-1">(</span><span class="hl-6">10</span><span class="hl-1">);</span><br/><span class="hl-1">            </span><span class="hl-3">expect</span><span class="hl-1">(</span><span class="hl-7">duration</span><span class="hl-1">).</span><span class="hl-3">toBeLessThan</span><span class="hl-1">(</span><span class="hl-6">2000</span><span class="hl-1">); </span><span class="hl-5">// 10 CAPTCHAs in under 2 seconds</span><br/><span class="hl-1">        });</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<h2 id="performance-optimization" class="tsd-anchor-link">Performance Optimization<a href="#performance-optimization" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><h3 id="captcha-service-with-caching" class="tsd-anchor-link">CAPTCHA Service with Caching<a href="#captcha-service-with-caching" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="javascript"><span class="hl-0">const</span><span class="hl-1"> { </span><span class="hl-2">CaptchaGenerator</span><span class="hl-1">, </span><span class="hl-2">resolveImage</span><span class="hl-1"> } = </span><span class="hl-3">require</span><span class="hl-1">(</span><span class="hl-4">&quot;captcha-canvas&quot;</span><span class="hl-1">);</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">LRU</span><span class="hl-1"> = </span><span class="hl-3">require</span><span class="hl-1">(</span><span class="hl-4">&quot;lru-cache&quot;</span><span class="hl-1">);</span><br/><br/><span class="hl-0">class</span><span class="hl-1"> </span><span class="hl-9">OptimizedCaptchaService</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">constructor</span><span class="hl-1">(</span><span class="hl-7">options</span><span class="hl-1"> = {}) {</span><br/><span class="hl-1">        </span><span class="hl-0">this</span><span class="hl-1">.</span><span class="hl-7">backgroundCache</span><span class="hl-1"> = </span><span class="hl-0">new</span><span class="hl-1"> </span><span class="hl-3">LRU</span><span class="hl-1">({</span><br/><span class="hl-1">            </span><span class="hl-7">max:</span><span class="hl-1"> </span><span class="hl-7">options</span><span class="hl-1">.</span><span class="hl-7">maxBackgrounds</span><span class="hl-1"> || </span><span class="hl-6">10</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-7">ttl:</span><span class="hl-1"> </span><span class="hl-7">options</span><span class="hl-1">.</span><span class="hl-7">backgroundTTL</span><span class="hl-1"> || </span><span class="hl-6">1000</span><span class="hl-1"> * </span><span class="hl-6">60</span><span class="hl-1"> * </span><span class="hl-6">60</span><span class="hl-1"> </span><span class="hl-5">// 1 hour</span><br/><span class="hl-1">        });</span><br/><span class="hl-1">        </span><br/><span class="hl-1">        </span><span class="hl-0">this</span><span class="hl-1">.</span><span class="hl-7">generatorPool</span><span class="hl-1"> = [];</span><br/><span class="hl-1">        </span><span class="hl-0">this</span><span class="hl-1">.</span><span class="hl-7">poolSize</span><span class="hl-1"> = </span><span class="hl-7">options</span><span class="hl-1">.</span><span class="hl-7">poolSize</span><span class="hl-1"> || </span><span class="hl-6">5</span><span class="hl-1">;</span><br/><span class="hl-1">        </span><br/><span class="hl-1">        </span><span class="hl-5">// Pre-create generator instances</span><br/><span class="hl-1">        </span><span class="hl-8">for</span><span class="hl-1"> (</span><span class="hl-0">let</span><span class="hl-1"> </span><span class="hl-7">i</span><span class="hl-1"> = </span><span class="hl-6">0</span><span class="hl-1">; </span><span class="hl-7">i</span><span class="hl-1"> &lt; </span><span class="hl-0">this</span><span class="hl-1">.</span><span class="hl-7">poolSize</span><span class="hl-1">; </span><span class="hl-7">i</span><span class="hl-1">++) {</span><br/><span class="hl-1">            </span><span class="hl-0">this</span><span class="hl-1">.</span><span class="hl-7">generatorPool</span><span class="hl-1">.</span><span class="hl-3">push</span><span class="hl-1">(</span><span class="hl-0">new</span><span class="hl-1"> </span><span class="hl-3">CaptchaGenerator</span><span class="hl-1">());</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">        </span><br/><span class="hl-1">        </span><span class="hl-0">this</span><span class="hl-1">.</span><span class="hl-7">currentGenerator</span><span class="hl-1"> = </span><span class="hl-6">0</span><span class="hl-1">;</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-0">async</span><span class="hl-1"> </span><span class="hl-3">loadBackground</span><span class="hl-1">(</span><span class="hl-7">path</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-8">if</span><span class="hl-1"> (!</span><span class="hl-0">this</span><span class="hl-1">.</span><span class="hl-7">backgroundCache</span><span class="hl-1">.</span><span class="hl-3">has</span><span class="hl-1">(</span><span class="hl-7">path</span><span class="hl-1">)) {</span><br/><span class="hl-1">            </span><span class="hl-8">try</span><span class="hl-1"> {</span><br/><span class="hl-1">                </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">image</span><span class="hl-1"> = </span><span class="hl-8">await</span><span class="hl-1"> </span><span class="hl-3">resolveImage</span><span class="hl-1">(</span><span class="hl-7">path</span><span class="hl-1">);</span><br/><span class="hl-1">                </span><span class="hl-0">this</span><span class="hl-1">.</span><span class="hl-7">backgroundCache</span><span class="hl-1">.</span><span class="hl-3">set</span><span class="hl-1">(</span><span class="hl-7">path</span><span class="hl-1">, </span><span class="hl-7">image</span><span class="hl-1">);</span><br/><span class="hl-1">            } </span><span class="hl-8">catch</span><span class="hl-1"> (</span><span class="hl-7">error</span><span class="hl-1">) {</span><br/><span class="hl-1">                </span><span class="hl-7">console</span><span class="hl-1">.</span><span class="hl-3">error</span><span class="hl-1">(</span><span class="hl-4">`Failed to load background: </span><span class="hl-0">${</span><span class="hl-7">path</span><span class="hl-0">}</span><span class="hl-4">`</span><span class="hl-1">, </span><span class="hl-7">error</span><span class="hl-1">);</span><br/><span class="hl-1">                </span><span class="hl-8">return</span><span class="hl-1"> </span><span class="hl-0">null</span><span class="hl-1">;</span><br/><span class="hl-1">            }</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">        </span><span class="hl-8">return</span><span class="hl-1"> </span><span class="hl-0">this</span><span class="hl-1">.</span><span class="hl-7">backgroundCache</span><span class="hl-1">.</span><span class="hl-3">get</span><span class="hl-1">(</span><span class="hl-7">path</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-3">getGenerator</span><span class="hl-1">() {</span><br/><span class="hl-1">        </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">generator</span><span class="hl-1"> = </span><span class="hl-0">this</span><span class="hl-1">.</span><span class="hl-7">generatorPool</span><span class="hl-1">[</span><span class="hl-0">this</span><span class="hl-1">.</span><span class="hl-7">currentGenerator</span><span class="hl-1">];</span><br/><span class="hl-1">        </span><span class="hl-0">this</span><span class="hl-1">.</span><span class="hl-7">currentGenerator</span><span class="hl-1"> = (</span><span class="hl-0">this</span><span class="hl-1">.</span><span class="hl-7">currentGenerator</span><span class="hl-1"> + </span><span class="hl-6">1</span><span class="hl-1">) % </span><span class="hl-0">this</span><span class="hl-1">.</span><span class="hl-7">poolSize</span><span class="hl-1">;</span><br/><span class="hl-1">        </span><span class="hl-8">return</span><span class="hl-1"> </span><span class="hl-7">generator</span><span class="hl-1">;</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-0">async</span><span class="hl-1"> </span><span class="hl-3">generateOptimized</span><span class="hl-1">(</span><span class="hl-7">config</span><span class="hl-1"> = {}) {</span><br/><span class="hl-1">        </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">generator</span><span class="hl-1"> = </span><span class="hl-0">this</span><span class="hl-1">.</span><span class="hl-3">getGenerator</span><span class="hl-1">();</span><br/><span class="hl-1">        </span><br/><span class="hl-1">        </span><span class="hl-5">// Reset generator state</span><br/><span class="hl-1">        </span><span class="hl-7">generator</span><br/><span class="hl-1">            .</span><span class="hl-3">setDimension</span><span class="hl-1">(</span><span class="hl-7">config</span><span class="hl-1">.</span><span class="hl-7">width</span><span class="hl-1"> || </span><span class="hl-6">300</span><span class="hl-1">, </span><span class="hl-7">config</span><span class="hl-1">.</span><span class="hl-7">height</span><span class="hl-1"> || </span><span class="hl-6">100</span><span class="hl-1">)</span><br/><span class="hl-1">            .</span><span class="hl-3">setCaptcha</span><span class="hl-1">(</span><span class="hl-7">config</span><span class="hl-1">.</span><span class="hl-7">captcha</span><span class="hl-1"> || { </span><span class="hl-7">characters:</span><span class="hl-1"> </span><span class="hl-6">6</span><span class="hl-1"> })</span><br/><span class="hl-1">            .</span><span class="hl-3">setTrace</span><span class="hl-1">(</span><span class="hl-7">config</span><span class="hl-1">.</span><span class="hl-7">trace</span><span class="hl-1"> || { </span><span class="hl-7">size:</span><span class="hl-1"> </span><span class="hl-6">3</span><span class="hl-1">, </span><span class="hl-7">opacity:</span><span class="hl-1"> </span><span class="hl-6">0.8</span><span class="hl-1"> })</span><br/><span class="hl-1">            .</span><span class="hl-3">setDecoy</span><span class="hl-1">(</span><span class="hl-7">config</span><span class="hl-1">.</span><span class="hl-7">decoy</span><span class="hl-1"> || { </span><span class="hl-7">total:</span><span class="hl-1"> </span><span class="hl-6">25</span><span class="hl-1">, </span><span class="hl-7">opacity:</span><span class="hl-1"> </span><span class="hl-6">0.3</span><span class="hl-1"> });</span><br/><span class="hl-1">        </span><br/><span class="hl-1">        </span><span class="hl-5">// Handle background if specified</span><br/><span class="hl-1">        </span><span class="hl-8">if</span><span class="hl-1"> (</span><span class="hl-7">config</span><span class="hl-1">.</span><span class="hl-7">backgroundPath</span><span class="hl-1">) {</span><br/><span class="hl-1">            </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">background</span><span class="hl-1"> = </span><span class="hl-8">await</span><span class="hl-1"> </span><span class="hl-0">this</span><span class="hl-1">.</span><span class="hl-3">loadBackground</span><span class="hl-1">(</span><span class="hl-7">config</span><span class="hl-1">.</span><span class="hl-7">backgroundPath</span><span class="hl-1">);</span><br/><span class="hl-1">            </span><span class="hl-8">if</span><span class="hl-1"> (</span><span class="hl-7">background</span><span class="hl-1">) {</span><br/><span class="hl-1">                </span><span class="hl-7">generator</span><span class="hl-1">.</span><span class="hl-3">setBackground</span><span class="hl-1">(</span><span class="hl-7">background</span><span class="hl-1">);</span><br/><span class="hl-1">            }</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">        </span><br/><span class="hl-1">        </span><span class="hl-8">return</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-7">buffer:</span><span class="hl-1"> </span><span class="hl-8">await</span><span class="hl-1"> </span><span class="hl-7">generator</span><span class="hl-1">.</span><span class="hl-3">generate</span><span class="hl-1">(),</span><br/><span class="hl-1">            </span><span class="hl-7">text:</span><span class="hl-1"> </span><span class="hl-7">generator</span><span class="hl-1">.</span><span class="hl-7">text</span><br/><span class="hl-1">        };</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-5">// Usage</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">service</span><span class="hl-1"> = </span><span class="hl-0">new</span><span class="hl-1"> </span><span class="hl-3">OptimizedCaptchaService</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-7">poolSize:</span><span class="hl-1"> </span><span class="hl-6">3</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-7">maxBackgrounds:</span><span class="hl-1"> </span><span class="hl-6">5</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<h2 id="mobile-friendly-captchas" class="tsd-anchor-link">Mobile-Friendly CAPTCHAs<a href="#mobile-friendly-captchas" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><h3 id="responsive-captcha-generation" class="tsd-anchor-link">Responsive CAPTCHA Generation<a href="#responsive-captcha-generation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="javascript"><span class="hl-0">const</span><span class="hl-1"> { </span><span class="hl-2">CaptchaGenerator</span><span class="hl-1"> } = </span><span class="hl-3">require</span><span class="hl-1">(</span><span class="hl-4">&quot;captcha-canvas&quot;</span><span class="hl-1">);</span><br/><br/><span class="hl-0">class</span><span class="hl-1"> </span><span class="hl-9">ResponsiveCaptchaService</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">constructor</span><span class="hl-1">() {</span><br/><span class="hl-1">        </span><span class="hl-0">this</span><span class="hl-1">.</span><span class="hl-7">presets</span><span class="hl-1"> = {</span><br/><span class="hl-1">            </span><span class="hl-7">mobile:</span><span class="hl-1"> {</span><br/><span class="hl-1">                </span><span class="hl-7">dimensions:</span><span class="hl-1"> { </span><span class="hl-7">width:</span><span class="hl-1"> </span><span class="hl-6">250</span><span class="hl-1">, </span><span class="hl-7">height:</span><span class="hl-1"> </span><span class="hl-6">80</span><span class="hl-1"> },</span><br/><span class="hl-1">                </span><span class="hl-7">captcha:</span><span class="hl-1"> { </span><br/><span class="hl-1">                    </span><span class="hl-7">characters:</span><span class="hl-1"> </span><span class="hl-6">5</span><span class="hl-1">, </span><br/><span class="hl-1">                    </span><span class="hl-7">size:</span><span class="hl-1"> </span><span class="hl-6">28</span><span class="hl-1">, </span><br/><span class="hl-1">                    </span><span class="hl-7">rotate:</span><span class="hl-1"> </span><span class="hl-6">8</span><span class="hl-1">,</span><br/><span class="hl-1">                    </span><span class="hl-7">skew:</span><span class="hl-1"> </span><span class="hl-0">false</span><span class="hl-1">  </span><span class="hl-5">// Less distortion for mobile</span><br/><span class="hl-1">                },</span><br/><span class="hl-1">                </span><span class="hl-7">trace:</span><span class="hl-1"> { </span><span class="hl-7">size:</span><span class="hl-1"> </span><span class="hl-6">2</span><span class="hl-1">, </span><span class="hl-7">opacity:</span><span class="hl-1"> </span><span class="hl-6">0.6</span><span class="hl-1"> },</span><br/><span class="hl-1">                </span><span class="hl-7">decoy:</span><span class="hl-1"> { </span><span class="hl-7">total:</span><span class="hl-1"> </span><span class="hl-6">15</span><span class="hl-1">, </span><span class="hl-7">opacity:</span><span class="hl-1"> </span><span class="hl-6">0.2</span><span class="hl-1"> }</span><br/><span class="hl-1">            },</span><br/><span class="hl-1">            </span><span class="hl-7">tablet:</span><span class="hl-1"> {</span><br/><span class="hl-1">                </span><span class="hl-7">dimensions:</span><span class="hl-1"> { </span><span class="hl-7">width:</span><span class="hl-1"> </span><span class="hl-6">320</span><span class="hl-1">, </span><span class="hl-7">height:</span><span class="hl-1"> </span><span class="hl-6">100</span><span class="hl-1"> },</span><br/><span class="hl-1">                </span><span class="hl-7">captcha:</span><span class="hl-1"> { </span><br/><span class="hl-1">                    </span><span class="hl-7">characters:</span><span class="hl-1"> </span><span class="hl-6">6</span><span class="hl-1">, </span><br/><span class="hl-1">                    </span><span class="hl-7">size:</span><span class="hl-1"> </span><span class="hl-6">35</span><span class="hl-1">, </span><br/><span class="hl-1">                    </span><span class="hl-7">rotate:</span><span class="hl-1"> </span><span class="hl-6">12</span><span class="hl-1"> </span><br/><span class="hl-1">                },</span><br/><span class="hl-1">                </span><span class="hl-7">trace:</span><span class="hl-1"> { </span><span class="hl-7">size:</span><span class="hl-1"> </span><span class="hl-6">2.5</span><span class="hl-1">, </span><span class="hl-7">opacity:</span><span class="hl-1"> </span><span class="hl-6">0.7</span><span class="hl-1"> },</span><br/><span class="hl-1">                </span><span class="hl-7">decoy:</span><span class="hl-1"> { </span><span class="hl-7">total:</span><span class="hl-1"> </span><span class="hl-6">20</span><span class="hl-1">, </span><span class="hl-7">opacity:</span><span class="hl-1"> </span><span class="hl-6">0.25</span><span class="hl-1"> }</span><br/><span class="hl-1">            },</span><br/><span class="hl-1">            </span><span class="hl-7">desktop:</span><span class="hl-1"> {</span><br/><span class="hl-1">                </span><span class="hl-7">dimensions:</span><span class="hl-1"> { </span><span class="hl-7">width:</span><span class="hl-1"> </span><span class="hl-6">400</span><span class="hl-1">, </span><span class="hl-7">height:</span><span class="hl-1"> </span><span class="hl-6">120</span><span class="hl-1"> },</span><br/><span class="hl-1">                </span><span class="hl-7">captcha:</span><span class="hl-1"> { </span><br/><span class="hl-1">                    </span><span class="hl-7">characters:</span><span class="hl-1"> </span><span class="hl-6">6</span><span class="hl-1">, </span><br/><span class="hl-1">                    </span><span class="hl-7">size:</span><span class="hl-1"> </span><span class="hl-6">45</span><span class="hl-1">, </span><br/><span class="hl-1">                    </span><span class="hl-7">rotate:</span><span class="hl-1"> </span><span class="hl-6">15</span><span class="hl-1"> </span><br/><span class="hl-1">                },</span><br/><span class="hl-1">                </span><span class="hl-7">trace:</span><span class="hl-1"> { </span><span class="hl-7">size:</span><span class="hl-1"> </span><span class="hl-6">3</span><span class="hl-1">, </span><span class="hl-7">opacity:</span><span class="hl-1"> </span><span class="hl-6">0.8</span><span class="hl-1"> },</span><br/><span class="hl-1">                </span><span class="hl-7">decoy:</span><span class="hl-1"> { </span><span class="hl-7">total:</span><span class="hl-1"> </span><span class="hl-6">30</span><span class="hl-1">, </span><span class="hl-7">opacity:</span><span class="hl-1"> </span><span class="hl-6">0.3</span><span class="hl-1"> }</span><br/><span class="hl-1">            },</span><br/><span class="hl-1">            </span><span class="hl-7">accessibility:</span><span class="hl-1"> {</span><br/><span class="hl-1">                </span><span class="hl-7">dimensions:</span><span class="hl-1"> { </span><span class="hl-7">width:</span><span class="hl-1"> </span><span class="hl-6">450</span><span class="hl-1">, </span><span class="hl-7">height:</span><span class="hl-1"> </span><span class="hl-6">150</span><span class="hl-1"> },</span><br/><span class="hl-1">                </span><span class="hl-7">captcha:</span><span class="hl-1"> { </span><br/><span class="hl-1">                    </span><span class="hl-7">characters:</span><span class="hl-1"> </span><span class="hl-6">5</span><span class="hl-1">, </span><br/><span class="hl-1">                    </span><span class="hl-7">size:</span><span class="hl-1"> </span><span class="hl-6">60</span><span class="hl-1">, </span><br/><span class="hl-1">                    </span><span class="hl-7">rotate:</span><span class="hl-1"> </span><span class="hl-6">5</span><span class="hl-1">,    </span><span class="hl-5">// Minimal rotation</span><br/><span class="hl-1">                    </span><span class="hl-7">skew:</span><span class="hl-1"> </span><span class="hl-0">false</span><span class="hl-1">,  </span><span class="hl-5">// No skewing</span><br/><span class="hl-1">                    </span><span class="hl-7">color:</span><span class="hl-1"> </span><span class="hl-4">&quot;#000000&quot;</span><span class="hl-1">  </span><span class="hl-5">// High contrast</span><br/><span class="hl-1">                },</span><br/><span class="hl-1">                </span><span class="hl-7">trace:</span><span class="hl-1"> { </span><span class="hl-7">size:</span><span class="hl-1"> </span><span class="hl-6">2</span><span class="hl-1">, </span><span class="hl-7">opacity:</span><span class="hl-1"> </span><span class="hl-6">0.3</span><span class="hl-1"> },</span><br/><span class="hl-1">                </span><span class="hl-7">decoy:</span><span class="hl-1"> { </span><span class="hl-7">total:</span><span class="hl-1"> </span><span class="hl-6">10</span><span class="hl-1">, </span><span class="hl-7">opacity:</span><span class="hl-1"> </span><span class="hl-6">0.1</span><span class="hl-1"> }</span><br/><span class="hl-1">            }</span><br/><span class="hl-1">        };</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-0">async</span><span class="hl-1"> </span><span class="hl-3">generate</span><span class="hl-1">(</span><span class="hl-7">deviceType</span><span class="hl-1"> = </span><span class="hl-4">&#39;desktop&#39;</span><span class="hl-1">, </span><span class="hl-7">customConfig</span><span class="hl-1"> = {}) {</span><br/><span class="hl-1">        </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">preset</span><span class="hl-1"> = </span><span class="hl-0">this</span><span class="hl-1">.</span><span class="hl-7">presets</span><span class="hl-1">[</span><span class="hl-7">deviceType</span><span class="hl-1">] || </span><span class="hl-0">this</span><span class="hl-1">.</span><span class="hl-7">presets</span><span class="hl-1">.</span><span class="hl-7">desktop</span><span class="hl-1">;</span><br/><span class="hl-1">        </span><br/><span class="hl-1">        </span><span class="hl-5">// Merge preset with custom configuration</span><br/><span class="hl-1">        </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">config</span><span class="hl-1"> = {</span><br/><span class="hl-1">            </span><span class="hl-7">dimensions:</span><span class="hl-1"> { ...</span><span class="hl-7">preset</span><span class="hl-1">.</span><span class="hl-7">dimensions</span><span class="hl-1">, ...</span><span class="hl-7">customConfig</span><span class="hl-1">.</span><span class="hl-7">dimensions</span><span class="hl-1"> },</span><br/><span class="hl-1">            </span><span class="hl-7">captcha:</span><span class="hl-1"> { ...</span><span class="hl-7">preset</span><span class="hl-1">.</span><span class="hl-7">captcha</span><span class="hl-1">, ...</span><span class="hl-7">customConfig</span><span class="hl-1">.</span><span class="hl-7">captcha</span><span class="hl-1"> },</span><br/><span class="hl-1">            </span><span class="hl-7">trace:</span><span class="hl-1"> { ...</span><span class="hl-7">preset</span><span class="hl-1">.</span><span class="hl-7">trace</span><span class="hl-1">, ...</span><span class="hl-7">customConfig</span><span class="hl-1">.</span><span class="hl-7">trace</span><span class="hl-1"> },</span><br/><span class="hl-1">            </span><span class="hl-7">decoy:</span><span class="hl-1"> { ...</span><span class="hl-7">preset</span><span class="hl-1">.</span><span class="hl-7">decoy</span><span class="hl-1">, ...</span><span class="hl-7">customConfig</span><span class="hl-1">.</span><span class="hl-7">decoy</span><span class="hl-1"> }</span><br/><span class="hl-1">        };</span><br/><span class="hl-1">        </span><br/><span class="hl-1">        </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">captcha</span><span class="hl-1"> = </span><span class="hl-0">new</span><span class="hl-1"> </span><span class="hl-3">CaptchaGenerator</span><span class="hl-1">(</span><span class="hl-7">config</span><span class="hl-1">.</span><span class="hl-7">dimensions</span><span class="hl-1">)</span><br/><span class="hl-1">            .</span><span class="hl-3">setCaptcha</span><span class="hl-1">(</span><span class="hl-7">config</span><span class="hl-1">.</span><span class="hl-7">captcha</span><span class="hl-1">)</span><br/><span class="hl-1">            .</span><span class="hl-3">setTrace</span><span class="hl-1">(</span><span class="hl-7">config</span><span class="hl-1">.</span><span class="hl-7">trace</span><span class="hl-1">)</span><br/><span class="hl-1">            .</span><span class="hl-3">setDecoy</span><span class="hl-1">(</span><span class="hl-7">config</span><span class="hl-1">.</span><span class="hl-7">decoy</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><br/><span class="hl-1">        </span><span class="hl-8">return</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-7">buffer:</span><span class="hl-1"> </span><span class="hl-8">await</span><span class="hl-1"> </span><span class="hl-7">captcha</span><span class="hl-1">.</span><span class="hl-3">generate</span><span class="hl-1">(),</span><br/><span class="hl-1">            </span><span class="hl-7">text:</span><span class="hl-1"> </span><span class="hl-7">captcha</span><span class="hl-1">.</span><span class="hl-7">text</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-7">deviceType</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-7">config</span><br/><span class="hl-1">        };</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-5">// Auto-detect device type from user agent</span><br/><span class="hl-1">    </span><span class="hl-3">detectDeviceType</span><span class="hl-1">(</span><span class="hl-7">userAgent</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">ua</span><span class="hl-1"> = </span><span class="hl-7">userAgent</span><span class="hl-1">.</span><span class="hl-3">toLowerCase</span><span class="hl-1">();</span><br/><span class="hl-1">        </span><br/><span class="hl-1">        </span><span class="hl-8">if</span><span class="hl-1"> (</span><span class="hl-11">/mobile</span><span class="hl-12">|</span><span class="hl-11">android</span><span class="hl-12">|</span><span class="hl-11">iphone</span><span class="hl-12">|</span><span class="hl-11">ipod</span><span class="hl-12">|</span><span class="hl-11">blackberry</span><span class="hl-12">|</span><span class="hl-11">windows phone/</span><span class="hl-1">.</span><span class="hl-3">test</span><span class="hl-1">(</span><span class="hl-7">ua</span><span class="hl-1">)) {</span><br/><span class="hl-1">            </span><span class="hl-8">return</span><span class="hl-1"> </span><span class="hl-4">&#39;mobile&#39;</span><span class="hl-1">;</span><br/><span class="hl-1">        } </span><span class="hl-8">else</span><span class="hl-1"> </span><span class="hl-8">if</span><span class="hl-1"> (</span><span class="hl-11">/tablet</span><span class="hl-12">|</span><span class="hl-11">ipad/</span><span class="hl-1">.</span><span class="hl-3">test</span><span class="hl-1">(</span><span class="hl-7">ua</span><span class="hl-1">)) {</span><br/><span class="hl-1">            </span><span class="hl-8">return</span><span class="hl-1"> </span><span class="hl-4">&#39;tablet&#39;</span><span class="hl-1">;</span><br/><span class="hl-1">        } </span><span class="hl-8">else</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-8">return</span><span class="hl-1"> </span><span class="hl-4">&#39;desktop&#39;</span><span class="hl-1">;</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-5">// Generate accessibility-friendly CAPTCHA</span><br/><span class="hl-1">    </span><span class="hl-0">async</span><span class="hl-1"> </span><span class="hl-3">generateAccessible</span><span class="hl-1">(</span><span class="hl-7">options</span><span class="hl-1"> = {}) {</span><br/><span class="hl-1">        </span><span class="hl-8">return</span><span class="hl-1"> </span><span class="hl-0">this</span><span class="hl-1">.</span><span class="hl-3">generate</span><span class="hl-1">(</span><span class="hl-4">&#39;accessibility&#39;</span><span class="hl-1">, {</span><br/><span class="hl-1">            </span><span class="hl-7">captcha:</span><span class="hl-1"> {</span><br/><span class="hl-1">                ...</span><span class="hl-7">options</span><span class="hl-1">,</span><br/><span class="hl-1">                </span><span class="hl-5">// Force accessibility settings</span><br/><span class="hl-1">                </span><span class="hl-7">rotate:</span><span class="hl-1"> </span><span class="hl-7">Math</span><span class="hl-1">.</span><span class="hl-3">min</span><span class="hl-1">(</span><span class="hl-7">options</span><span class="hl-1">.</span><span class="hl-7">rotate</span><span class="hl-1"> || </span><span class="hl-6">5</span><span class="hl-1">, </span><span class="hl-6">5</span><span class="hl-1">),</span><br/><span class="hl-1">                </span><span class="hl-7">skew:</span><span class="hl-1"> </span><span class="hl-0">false</span><span class="hl-1">,</span><br/><span class="hl-1">                </span><span class="hl-7">color:</span><span class="hl-1"> </span><span class="hl-7">options</span><span class="hl-1">.</span><span class="hl-7">color</span><span class="hl-1"> || </span><span class="hl-4">&quot;#000000&quot;</span><br/><span class="hl-1">            }</span><br/><span class="hl-1">        });</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-5">// Express.js integration</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">responsiveService</span><span class="hl-1"> = </span><span class="hl-0">new</span><span class="hl-1"> </span><span class="hl-3">ResponsiveCaptchaService</span><span class="hl-1">();</span><br/><br/><span class="hl-7">app</span><span class="hl-1">.</span><span class="hl-3">get</span><span class="hl-1">(</span><span class="hl-4">&#39;/captcha&#39;</span><span class="hl-1">, </span><span class="hl-0">async</span><span class="hl-1"> (</span><span class="hl-7">req</span><span class="hl-1">, </span><span class="hl-7">res</span><span class="hl-1">) </span><span class="hl-0">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-8">try</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">deviceType</span><span class="hl-1"> = </span><span class="hl-7">responsiveService</span><span class="hl-1">.</span><span class="hl-3">detectDeviceType</span><span class="hl-1">(</span><br/><span class="hl-1">            </span><span class="hl-7">req</span><span class="hl-1">.</span><span class="hl-7">headers</span><span class="hl-1">[</span><span class="hl-4">&#39;user-agent&#39;</span><span class="hl-1">] || </span><span class="hl-4">&#39;&#39;</span><br/><span class="hl-1">        );</span><br/><span class="hl-1">        </span><br/><span class="hl-1">        </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">accessibility</span><span class="hl-1"> = </span><span class="hl-7">req</span><span class="hl-1">.</span><span class="hl-7">query</span><span class="hl-1">.</span><span class="hl-7">accessibility</span><span class="hl-1"> === </span><span class="hl-4">&#39;true&#39;</span><span class="hl-1">;</span><br/><span class="hl-1">        </span><br/><span class="hl-1">        </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">result</span><span class="hl-1"> = </span><span class="hl-7">accessibility</span><span class="hl-1"> </span><br/><span class="hl-1">            ? </span><span class="hl-8">await</span><span class="hl-1"> </span><span class="hl-7">responsiveService</span><span class="hl-1">.</span><span class="hl-3">generateAccessible</span><span class="hl-1">()</span><br/><span class="hl-1">            : </span><span class="hl-8">await</span><span class="hl-1"> </span><span class="hl-7">responsiveService</span><span class="hl-1">.</span><span class="hl-3">generate</span><span class="hl-1">(</span><span class="hl-7">deviceType</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><br/><span class="hl-1">        </span><span class="hl-7">req</span><span class="hl-1">.</span><span class="hl-7">session</span><span class="hl-1">.</span><span class="hl-7">captcha</span><span class="hl-1"> = {</span><br/><span class="hl-1">            </span><span class="hl-7">solution:</span><span class="hl-1"> </span><span class="hl-7">result</span><span class="hl-1">.</span><span class="hl-7">text</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-7">deviceType:</span><span class="hl-1"> </span><span class="hl-7">result</span><span class="hl-1">.</span><span class="hl-7">deviceType</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-7">timestamp:</span><span class="hl-1"> </span><span class="hl-7">Date</span><span class="hl-1">.</span><span class="hl-3">now</span><span class="hl-1">()</span><br/><span class="hl-1">        };</span><br/><span class="hl-1">        </span><br/><span class="hl-1">        </span><span class="hl-7">res</span><span class="hl-1">.</span><span class="hl-3">type</span><span class="hl-1">(</span><span class="hl-4">&#39;png&#39;</span><span class="hl-1">).</span><span class="hl-3">send</span><span class="hl-1">(</span><span class="hl-7">result</span><span class="hl-1">.</span><span class="hl-7">buffer</span><span class="hl-1">);</span><br/><span class="hl-1">    } </span><span class="hl-8">catch</span><span class="hl-1"> (</span><span class="hl-7">error</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-7">console</span><span class="hl-1">.</span><span class="hl-3">error</span><span class="hl-1">(</span><span class="hl-4">&#39;Responsive CAPTCHA error:&#39;</span><span class="hl-1">, </span><span class="hl-7">error</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-7">res</span><span class="hl-1">.</span><span class="hl-3">status</span><span class="hl-1">(</span><span class="hl-6">500</span><span class="hl-1">).</span><span class="hl-3">json</span><span class="hl-1">({ </span><span class="hl-7">error:</span><span class="hl-1"> </span><span class="hl-4">&#39;CAPTCHA generation failed&#39;</span><span class="hl-1"> });</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p>This comprehensive usage guide covers all the major use cases and patterns for the captcha-canvas library, from basic generation to advanced enterprise-level implementations with error handling, performance optimization, and accessibility considerations.</p>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg><h3>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg><h3>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#usage-examples"><span>Usage <wbr/>Examples</span></a><ul><li><a href="#table-of-contents"><span>Table of <wbr/>Contents</span></a></li><li><a href="#basic-usage"><span>Basic <wbr/>Usage</span></a></li><li><ul><li><a href="#simple-captcha-generation"><span>Simple <wbr/>CAPTCHA <wbr/>Generation</span></a></li><li><a href="#using-captchagenerator-class"><span>Using <wbr/>Captcha<wbr/>Generator <wbr/>Class</span></a></li><li><a href="#typescript-usage"><span>Type<wbr/>Script <wbr/>Usage</span></a></li></ul></li><li><a href="#web-integration"><span>Web <wbr/>Integration</span></a></li><li><ul><li><a href="#expressjs-server-with-session-management"><span>Express.js <wbr/>Server with <wbr/>Session <wbr/>Management</span></a></li><li><a href="#nextjs-api-routes"><span>Next.js <wbr/>API <wbr/>Routes</span></a></li></ul></li><li><a href="#advanced-customization"><span>Advanced <wbr/>Customization</span></a></li><li><ul><li><a href="#multi-color-rainbow-text"><span>Multi-<wbr/>Color <wbr/>Rainbow <wbr/>Text</span></a></li><li><a href="#multi-styled-text-segments"><span>Multi-<wbr/>Styled <wbr/>Text <wbr/>Segments</span></a></li><li><a href="#background-image-with-noise-pattern"><span>Background <wbr/>Image with <wbr/>Noise <wbr/>Pattern</span></a></li><li><a href="#high-security-configuration"><span>High <wbr/>Security <wbr/>Configuration</span></a></li></ul></li><li><a href="#synchronous-generation"><span>Synchronous <wbr/>Generation</span></a></li><li><ul><li><a href="#batch-processing-for-pre-generation"><span>Batch <wbr/>Processing for <wbr/>Pre-<wbr/>generation</span></a></li></ul></li><li><a href="#error-handling"><span>Error <wbr/>Handling</span></a></li><li><ul><li><a href="#comprehensive-error-handling"><span>Comprehensive <wbr/>Error <wbr/>Handling</span></a></li></ul></li><li><a href="#testing"><span>Testing</span></a></li><li><ul><li><a href="#comprehensive-test-suite"><span>Comprehensive <wbr/>Test <wbr/>Suite</span></a></li></ul></li><li><a href="#performance-optimization"><span>Performance <wbr/>Optimization</span></a></li><li><ul><li><a href="#captcha-service-with-caching"><span>CAPTCHA <wbr/>Service with <wbr/>Caching</span></a></li></ul></li><li><a href="#mobile-friendly-captchas"><span>Mobile-<wbr/>Friendly <wbr/>CAPTCH<wbr/>As</span></a></li><li><ul><li><a href="#responsive-captcha-generation"><span>Responsive <wbr/>CAPTCHA <wbr/>Generation</span></a></li></ul></li></ul></div></details></div><div class="site-menu"><nav id="tsd-sidebar-links" class="tsd-navigation"><a href="https://github.com/Shashank3736/captcha-canvas" class="tsd-nav-link">GitHub</a><a href="https://www.npmjs.com/package/captcha-canvas" class="tsd-nav-link">NPM</a></nav><nav class="tsd-navigation"><a href="../modules.html">captcha-canvas API Documentation - v3.3.4</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>
